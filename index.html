<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mind Mender: The Architect (Complete Edition)</title>
    <style>
        :root {
            --bg-color: #263238;
            --panel-bg: #eceff1;
            --text-color: #2c3e50;
            --accent: #37474f;
            --highlight: #fbc02d;
            --trust-high: #2e7d32;
            --trust-mid: #f57f17;
            --trust-low: #c62828;
            --note-bg: #fff9c4;
            --folder-alex: #e3f2fd; /* Light Blue */
            --folder-elena: #f3e5f5; /* Light Purple */
            --folder-sarah: #e0f2f1; /* Light Teal - New Client */
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', 'Roboto', Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            height: 100dvh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            font-size: 14px;
        }

        /* --- SCREENS --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; z-index: 10;
        }
        .screen.active { display: flex; animation: fadeIn 0.3s ease; }

        /* --- 0. CLIENT SELECTION SCREEN --- */
        #selectionScreen {
            background: var(--bg-color);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .db-title {
            color: #eceff1; font-family: 'Courier New', monospace;
            font-size: 2em; margin-bottom: 40px; letter-spacing: 3px;
            border-bottom: 2px solid #546e7a; padding-bottom: 10px;
            text-transform: uppercase; text-align: center;
        }

        .folder-container {
            display: flex; gap: 40px; flex-wrap: wrap; justify-content: center;
            overflow-y: visible; /* Changed from auto to visible to prevent clipping */
            padding: 20px; /* Added padding to ensure hover effect isn't cut off */
            width: 100%;
        }

        .folder {
            width: 220px; height: 160px;
            background: #cfd8dc;
            border-radius: 0 10px 10px 10px;
            position: relative;
            cursor: pointer;
            transition: 0.3s;
            display: flex; flex-direction: column;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            flex-shrink: 0; /* Prevent shrinking */
            border: 1px solid rgba(255,255,255,0.2); /* Subtle border */
            margin-top: 15px; /* Added margin to accommodate the tab sticking out */
        }
        /* Folder Tab */
        .folder::before {
            content: ''; position: absolute; top: -15px; left: 0;
            width: 90px; height: 15px;
            background: inherit;
            border-radius: 10px 10px 0 0;
            border-top: 1px solid rgba(255,255,255,0.2);
            border-left: 1px solid rgba(255,255,255,0.2);
            border-right: 1px solid rgba(255,255,255,0.2);
        }
        .folder:hover { transform: translateY(-10px); filter: brightness(1.05); box-shadow: 0 15px 40px rgba(0,0,0,0.6); }

        .folder.alex { background: var(--folder-alex); }
        .folder.elena { background: var(--folder-elena); }
        .folder.sarah { background: var(--folder-sarah); }

        .folder-label {
            font-family: 'Courier New', monospace; font-weight: bold;
            font-size: 1.2em; margin-top: auto; color: #263238; /* Dark Text */
            border-top: 2px solid rgba(0,0,0,0.1); padding-top: 10px;
        }
        .folder-icon {
            font-size: 2.5em; opacity: 0.5; align-self: flex-end; margin-bottom: auto; color: #546e7a;
        }
        .folder-status {
            font-size: 0.75em; text-transform: uppercase; letter-spacing: 1px;
            color: #455a64; margin-bottom: 5px; font-weight: bold;
        }


        /* --- 1. SESSION MENU --- */
        #menuScreen {
            background: var(--bg-color);
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }
        .menu-card {
            background: #fff; width: 100%; max-width: 500px;
            padding: 25px; border-radius: 4px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative;
            min-height: 400px;
        }
        .back-btn {
            position: absolute; top: 20px; left: 20px;
            background: transparent; border: none; font-weight: bold; color: #78909c;
            cursor: pointer; font-size: 1.5em; line-height: 1; padding: 0;
        }
        .back-btn:hover { color: #37474f; transform: scale(1.1); }

        .case-title {
            font-family: 'Courier New', monospace;
            text-align: center; color: var(--bg-color);
            border-bottom: 2px solid var(--bg-color);
            padding-bottom: 8px; margin-bottom: 15px; margin-top: 10px;
            font-size: 1.3em; font-weight: bold;
        }
        .chapter-label {
            font-size: 0.75em; color: #78909c; text-transform: uppercase;
            letter-spacing: 1px; margin: 20px 0 8px 0; border-bottom: 1px solid #eee;
            font-weight: bold;
        }
        .session-btn {
            width: 100%; background: #f5f5f5; border: 1px solid #ddd;
            border-left: 4px solid #ccc; padding: 12px; margin-bottom: 8px;
            text-align: left; cursor: pointer; transition: 0.2s;
            position: relative;
        }
        .session-btn:hover:not(.locked) { background: #fff; border-left-color: var(--accent); transform: translateX(3px); }
        .s-name { display: block; font-weight: bold; color: #333; font-family: 'Courier New', monospace; font-size: 0.95em; }
        .s-desc { font-size: 0.8em; color: #666; display: block; margin-top: 2px; }

        .session-btn.locked {
            opacity: 0.6; cursor: not-allowed; background: #eee; border-left-color: #999;
        }
        .session-btn.locked .s-name::after {
            content: " üîí"; font-size: 0.9em;
        }
        .session-btn.completed .s-name::after {
            content: " ‚úì"; color: green;
        }

        /* --- 2. BRIEFING --- */
        #briefingScreen {
            background: rgba(0,0,0,0.9); justify-content: center; align-items: center;
        }
        .file-paper {
            background: #fafafa; width: 600px; max-width: 90%; padding: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); transform: rotate(-1deg);
            max-height: 90vh; overflow-y: auto;
        }

        /* --- 3. GAMEPLAY --- */
        .app-container {
            width: 100%; height: 100%; display: flex; background: #fff;
        }

        /* Left: Chat */
        .chat-panel {
            flex: 2; display: flex; flex-direction: column;
            border-right: 1px solid #ddd; background: #fff;
            min-width: 0;
        }
        .top-bar {
            padding: 8px 15px; background: #eceff1; border-bottom: 1px solid #ddd;
            display: flex; justify-content: space-between; align-items: center;
            flex-shrink: 0; height: 50px;
        }
        .profile { display: flex; align-items: center; gap: 10px; }
        .avatar {
            width: 32px; height: 32px; background: #78909c; color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 0.9em;
        }
        .info h3 { margin: 0; font-size: 0.9em; color: #37474f; line-height: 1.1; }
        .info span { font-size: 0.75em; color: #7f8c8d; display: block; }
        .trust-meter { text-align: right; }
        .trust-label { font-size: 0.65em; font-weight: bold; color: #78909c; display: block; margin-bottom: 2px; }
        .pips { display: flex; gap: 3px; }
        .pip { width: 8px; height: 8px; border-radius: 50%; background: #cfd8dc; transition: 0.3s; }
        .pip.filled { transform: scale(1.1); }

        .chat-log {
            flex-grow: 1; padding: 15px; overflow-y: auto; background: #f8f9fa;
            display: flex; flex-direction: column;
        }
        .msg {
            max-width: 85%; margin-bottom: 12px; line-height: 1.45;
            position: relative; animation: fadeIn 0.3s ease; font-size: 0.95rem;
        }
        .msg.client { align-self: flex-start; color: #263238; }
        .msg.therapist {
            align-self: flex-end; background: #e0f2f1; padding: 10px 14px;
            border-radius: 12px 12px 0 12px; color: #00695c; font-style: italic;
            border: 1px solid #b2dfdb; font-size: 0.9rem;
        }
        .msg.system {
            align-self: center; font-size: 0.75em; color: #90a4ae;
            background: #eceff1; padding: 3px 10px; border-radius: 10px; margin: 8px 0;
        }

        .input-area {
            padding: 10px 15px; background: #fff; border-top: 1px solid #e0e0e0;
            min-height: auto; flex-shrink: 0;
        }
        .choices { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        .choice-btn {
            background: #fff; border: 1px solid #cfd8dc; border-radius: 4px;
            padding: 10px; color: #546e7a; cursor: pointer; text-align: left;
            font-size: 0.9em; transition: 0.1s; display: flex; align-items: center;
            line-height: 1.3; min-height: 45px;
        }
        .choice-btn:hover { border-color: #37474f; color: #263238; background: #fafafa; }

        /* Right: Notebook */
        .notebook-panel {
            flex: 1; background: var(--note-bg); border-left: 1px solid #cfd8dc;
            display: flex; flex-direction: column; padding: 15px; max-width: 350px;
            min-width: 0;
        }
        .notebook-title {
            font-family: 'Courier New', monospace; font-weight: bold; color: #5d4037;
            border-bottom: 2px solid #5d4037; padding-bottom: 5px; margin-bottom: 10px;
            display: flex; justify-content: space-between; font-size: 0.9em; flex-shrink: 0;
        }
        .clue-zone {
            flex-grow: 1; display: flex; flex-wrap: wrap; align-content: flex-start;
            gap: 6px; overflow-y: auto; margin-bottom: 10px;
        }
        .clue-card {
            background: #fff; border: 1px solid #d7ccc8; padding: 6px 10px;
            font-family: 'Courier New', monospace; font-size: 0.8em; font-weight: bold;
            cursor: pointer; box-shadow: 1px 1px 0 rgba(0,0,0,0.1); transition: 0.1s;
            transform: rotate(-1deg);
        }
        .clue-card:hover { transform: translateY(-2px); z-index: 2; }
        .clue-card.selected { background: #333; color: white; border-color: #000; transform: scale(1.05); }

        .formulation-zone { border-top: 1px solid #d7ccc8; padding-top: 10px; flex-shrink: 0; }
        .insight-list { list-style: none; padding: 0; margin: 0 0 10px 0; }
        .insight-item { font-size: 0.8em; color: #a1887f; margin-bottom: 4px; opacity: 0.7; }
        .insight-item.done { color: #2e7d32; font-weight: bold; opacity: 1; }

        .btn-action {
            width: 100%; padding: 10px; border: none; border-radius: 3px;
            font-weight: bold; font-family: 'Courier New', monospace;
            cursor: pointer; margin-bottom: 5px; text-transform: uppercase;
            transition: 0.2s; font-size: 0.85em;
        }
        .btn-link { background: #795548; color: white; }
        .btn-solve { background: #2e7d32; color: white; display: none; }

        /* Keywords */
        .keyword { padding: 0 2px; border-radius: 2px; transition: 0.2s; }
        .keyword.hidden { color: inherit; cursor: default; }
        .keyword.revealed {
            background: rgba(251, 192, 45, 0.2);
            border-bottom: 2px solid var(--highlight);
            cursor: pointer; font-weight: 600;
        }
        .keyword.revealed:hover { background: rgba(251, 192, 45, 0.5); }
        .keyword.collected {
            background: transparent; border-bottom: 1px dashed #bdbdbd;
            color: #90a4ae; cursor: default; font-weight: normal;
        }

        /* OVERLAYS */
        .toast {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            background: #333; color: white; padding: 8px 16px; border-radius: 20px;
            font-size: 0.8em; pointer-events: none; opacity: 0; transition: 0.3s; z-index: 9999;
        }
        #victoryScreen {
            background: rgba(0,0,0,0.9); justify-content: center; align-items: center; padding: 20px;
        }
        .victory-box { background: white; padding: 30px; border-radius: 8px; max-width: 400px; text-align: center; }

        /* FORCE LANDSCAPE MESSAGE */
        #rotate-overlay {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); color: #eceff1; z-index: 99999;
            flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 20px;
        }
        .rotate-icon { font-size: 40px; margin-bottom: 15px; animation: rotatePhone 2s infinite ease-in-out; }

        @keyframes rotatePhone {
            0%, 10% { transform: rotate(0deg); opacity: 1; }
            40%, 60% { transform: rotate(-90deg); opacity: 1; }
            100% { transform: rotate(-90deg); opacity: 0; }
        }

        /* PORTRAIT LOCK ON MOBILE */
        @media only screen and (max-width: 768px) and (orientation: portrait) {
            #rotate-overlay { display: flex; }
            .screen { display: none !important; }
        }

        /* --- MOBILE LANDSCAPE OPTIMIZATIONS --- */
        @media (max-height: 500px) and (orientation: landscape) {
            body { font-size: 13px; }

            .app-container { flex-direction: row; align-items: stretch; }

            /* Left Chat Panel */
            .chat-panel {
                flex: 2;
                border-right: 2px solid #ddd;
            }
            .top-bar {
                height: 35px;
                padding: 0 10px;
            }
            .avatar { width: 24px; height: 24px; font-size: 0.7em; }
            .info h3 { font-size: 0.85em; display: inline-block; margin-right: 5px;}
            .info span { display: inline-block; font-size: 0.7em; }
            .trust-meter { display: flex; align-items: center; gap: 5px; }
            .trust-label { margin-bottom: 0; font-size: 0.6em; }

            .chat-log { padding: 10px; }
            .msg { margin-bottom: 8px; font-size: 0.9em; max-width: 90%; }

            .input-area {
                padding: 5px 10px;
                min-height: auto;
            }
            .choices { gap: 5px; }
            .choice-btn { padding: 6px 8px; font-size: 0.8em; min-height: 35px; }

            /* Right Notebook Panel */
            .notebook-panel {
                flex: 1;
                max-width: 35%;
                padding: 8px;
                background: #fffdeb;
            }
            .notebook-title { margin-bottom: 5px; padding-bottom: 2px; font-size: 0.85em; }

            .clue-zone {
                gap: 4px;
                flex-grow: 1;
                max-height: 50%;
                margin-bottom: 5px;
            }
            .clue-card { padding: 4px 6px; font-size: 0.75em; }

            .formulation-zone { padding-top: 5px; margin-top: auto; }
            .insight-list { margin-bottom: 5px; }
            .insight-item { font-size: 0.75em; margin-bottom: 2px; }

            .btn-action {
                padding: 6px;
                margin-bottom: 3px;
                font-size: 0.75em;
            }

            /* Modals */
            .menu-card, .file-paper, .victory-box {
                display: flex;
                flex-direction: column;
                max-height: 95vh;
                padding: 15px;
                width: 90%;
                max-width: 600px;
                overflow-y: auto;
            }
            .case-title { font-size: 1.2em; margin-bottom: 10px; padding-bottom: 5px; }
            .session-btn { padding: 8px; margin-bottom: 5px; }
            .folder-container { padding: 5px; gap: 15px; }
            .folder { width: 180px; height: 130px; padding: 15px; }
            .db-title { font-size: 1.5em; margin-bottom: 15px; }
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="rotate-overlay">
        <div class="rotate-icon">üì±</div>
        <div style="font-family: 'Courier New', monospace; font-weight: bold; letter-spacing: 1px;">PLEASE ROTATE DEVICE</div>
    </div>

    <div id="toast" class="toast"></div>

    <!-- 0. CLIENT SELECTION (NEW) -->
    <div id="selectionScreen" class="screen active">
        <div class="db-title">CASE DATABASE</div>
        <div class="folder-container">
            <div class="folder alex" onclick="showClientMenu('alex')">
                <div class="folder-icon">üìÇ</div>
                <div class="folder-status">STATUS: ACTIVE</div>
                <div class="folder-label">01: ALEX M.</div>
            </div>
            <div class="folder elena" onclick="showClientMenu('elena')">
                <div class="folder-icon">üìÇ</div>
                <div class="folder-status">STATUS: ACTIVE</div>
                <div class="folder-label">02: ELENA R.</div>
            </div>
            <div class="folder sarah" onclick="showClientMenu('sarah')">
                <div class="folder-icon">üìÇ</div>
                <div class="folder-status">STATUS: NEW</div>
                <div class="folder-label">03: SARAH T.</div>
            </div>
        </div>
    </div>

    <!-- 1. SESSION MENU (DYNAMIC) -->
    <div id="menuScreen" class="screen">
        <div class="menu-card">
            <button class="back-btn" onclick="showSelectionScreen()">‚Üê</button>
            <div class="case-title" id="menuTitle">CLIENT NAME</div>
            <div id="sessionList"></div>
        </div>
    </div>

    <!-- 2. BRIEFING -->
    <div id="briefingScreen" class="screen">
        <div class="file-paper">
            <h2 style="font-family:'Courier New'; margin-top:0; font-size: 1.2em;">CASE FILE</h2>
            <div id="briefingText" style="line-height:1.5; color:#444; margin: 15px 0; font-size: 0.95em;"></div>
            <button class="btn-action" style="background:#37474f; color:white;" onclick="startGame()">ENTER SESSION</button>
        </div>
    </div>

    <!-- 3. GAMEPLAY -->
    <div id="gameScreen" class="screen">
        <div class="app-container">
            <div class="chat-panel">
                <div class="top-bar">
                    <div class="profile"><div class="avatar" id="avatarDisplay">AM</div><div class="info"><h3 id="sessionTitleDisplay">S1</h3></div></div>
                    <div class="trust-meter"><span class="trust-label" id="trustLabel">RAPPORT: NEUTRAL</span><div class="pips"><div class="pip"></div><div class="pip"></div><div class="pip"></div><div class="pip"></div><div class="pip"></div></div></div>
                </div>
                <div class="chat-log" id="chatLog"></div>
                <div class="input-area">
                    <div style="text-align:center; color:#90a4ae; font-size:0.7em; margin-bottom:5px; letter-spacing:1px;" id="choicePrompt">CHOOSE RESPONSE</div>
                    <div class="choices" id="choice-ui-container"></div>
                </div>
            </div>
            <div class="notebook-panel">
                <div class="notebook-title"><span>NOTES</span><span id="noteCount">0</span></div>
                <div class="clue-zone" id="clueBoard"></div>
                <div class="formulation-zone">
                    <ul class="insight-list" id="insightList"></ul>
                    <button class="btn-action btn-link" id="btnLink" onclick="linkNotes()">LINK (0/2)</button>
                    <button class="btn-action btn-solve" id="btnSolve" onclick="finishSession()">PRESENT FORMULATION</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. VICTORY -->
    <div id="victoryScreen" class="screen">
        <div class="victory-box">
            <h2 style="color:#2e7d32;">COMPLETE</h2>
            <div id="victoryText" style="margin:20px 0; font-size:0.95em;"></div>
            <button class="btn-action" style="background:#333; color:white;" onclick="returnToMenu()">CASE FILES</button>
        </div>
    </div>

    <script>
        /* ================= DATA ================= */
        // SESSIONS 0-7: ALEX, 8-15: ELENA, 16+: SARAH
        const SESSIONS = [
            // --- ALEX M (0-7) ---
            {
                id: 0, client: "Alex M.", title: "The Architect",
                briefing: "<p><strong>Subject:</strong> Alex M. (28)<br><strong>Notes:</strong> Defensive, perfectionist. Reports panic attack during review.</p><p><strong>Goal:</strong> Find the roots of his workplace anxiety.</p>",
                trust: 3,
                script: [
                    {
                        text: "I shouldn't be here. It‚Äôs just a job. People get mad at work, right? It‚Äôs not a 'clinical issue'.",
                        keywords: [],
                        choices: [
                            {text:"You seem defensive. What are you afraid of admitting?", change:-1},
                            {text:"It sounds like you're trying to minimize what happened.", change:0},
                            {text:"You're right, work is stressful. But something must feel different this time.", change:1}
                        ]
                    },
                    {
                        text: "It wasn't just a typical day. It was my annual <span class='keyword' data-key='Performance Review'>Performance Review</span>. I walked in there knowing my numbers were perfect. I needed that validation.",
                        keywords:["Performance Review"],
                        choices: [
                            {text:"Did you get the validation you wanted?", change:0},
                            {text:"Why is validation so important to you? Are you insecure?", change:-1},
                            {text:"So it wasn't just a meeting. It was a judgment day.", change:1}
                        ]
                    },
                    {
                        text: "Exactly. But Halloway... he didn't say a word. He just sat there, reading my file in total <span class='keyword' data-key='Silence'>Silence</span>. He didn't even offer me a chair.",
                        keywords:["Silence"],
                        choices: [
                            {text:"That silence must have felt incredibly heavy.", change:1},
                            {text:"He sounds like a rude boss.", change:0},
                            {text:"What did you do during the silence? Did you speak?", change:-1}
                        ]
                    },
                    {
                        text: "Speak? I felt <span class='keyword' data-key='Frozen'>Frozen</span>. My hands started shaking. I‚Äôm a 28-year-old architect, and I couldn't breathe.",
                        keywords:["Frozen"],
                        choices: [
                            {text:"You were having a panic attack.", change:-1},
                            {text:"Your body was reacting to a threat.", change:1},
                            {text:"That sounds frightening.", change:0}
                        ]
                    },
                    {
                        text: "I felt... <span class='keyword' data-key='Small'>Small</span>. That's the only word for it. Like I‚Äôd shrunk down to nothing. Powerless.",
                        keywords:["Small"],
                        choices: [
                            {text:"Small like a child?", change:1},
                            {text:"Powerless in what way?", change:0},
                            {text:"You shouldn't let him make you feel that way.", change:-1}
                        ]
                    },
                    {
                        text: "Then he looked over his glasses. My <span class='keyword' data-key='Boss'>Boss</span> has this specific look of disappointment. That's when I snapped.",
                        keywords:["Boss"],
                        choices: [
                            {text:"The disappointment was the trigger.", change:1},
                            {text:"So you got angry at his face?", change:-1},
                            {text:"Tell me more about the look.", change:0}
                        ]
                    },
                    {
                        text: "It‚Äôs weird. When I think about that look, I don't see the office. I see our old <span class='keyword' data-key='Kitchen Table'>Kitchen Table</span>.",
                        keywords:["Kitchen Table"],
                        choices: [
                            {text:"Stay with that image. What's happening at the table?", change:1},
                            {text:"Why a kitchen table?", change:0},
                            {text:"That seems irrelevant.", change:-2}
                        ]
                    },
                    {
                        text: "I'm sitting there. Waiting for my <span class='keyword' data-key='Father'>Father</span>. He‚Äôs reviewing my <span class='keyword' data-key='Grades'>Grades</span>. If I got a B, he wouldn't yell. He‚Äôd just give me that exact same look.",
                        keywords:["Father","Grades"],
                        choices: [
                            {text:"And in that moment, your boss became your father.", change:2},
                            {text:"Your father sounds strict.", change:0},
                            {text:"So you have daddy issues?", change:-3}
                        ]
                    }
                ],
                formulation: [
                    { id:1, keys:["Performance Review","Grades"], title:"Pressure (Context)" },
                    { id:2, keys:["Silence","Kitchen Table"], title:"Trigger (Memory)" },
                    { id:3, keys:["Boss","Father"], title:"Root (Transference)" }
                ],
                outro: "Alex realizes he reacted to his boss as if he were his father. The immediate panic subsides as he separates the past from the present."
            },
            {
                id: 1, client: "Alex M.", title: "The Aftermath",
                briefing: "<p><strong>Update:</strong> 1 Week Later. Alex has missed work for 3 days.</p><p><strong>Goal:</strong> Address his avoidance and shame cycle.</p><p><strong>Warning:</strong> Rapport is low (2/5).</p>",
                trust: 2,
                script: [
                    {
                        text: "So... I didn't go back. I haven't been to the office since we spoke. I know, I know. I failed.",
                        keywords: [],
                        choices: [
                            {text:"You didn't fail, Alex. You're coping.", change:1},
                            {text:"Why did you avoid going in?", change:-1},
                            {text:"Let's talk about what happened instead.", change:0}
                        ]
                    },
                    {
                        text: "I called in and took <span class='keyword' data-key='Sick Leave'>Sick Leave</span>. As soon as I hung up the phone, I felt this massive wave of <span class='keyword' data-key='Relief'>Relief</span>.",
                        keywords:["Sick Leave","Relief"],
                        choices: [
                            {text:"That relief is very seductive, isn't it?", change:1},
                            {text:"Of course you felt relief, you ran away.", change:-2},
                            {text:"How long did the relief last?", change:0}
                        ]
                    },
                    {
                        text: "Yeah, but then the guilt set in. I tried to write an apology email. I have this <span class='keyword' data-key='Unsent Draft'>Unsent Draft</span> sitting on my screen for three days.",
                        keywords:["Unsent Draft"],
                        choices: [
                            {text:"What stops you from hitting send?", change:0},
                            {text:"You should just send it and get it over with.", change:-1},
                            {text:"It sits there like an accusation.", change:1}
                        ]
                    },
                    {
                        text: "Exactly. Every time I try to finish it, I hear my <span class='keyword' data-key='Fathers Voice'>Fathers Voice</span>. 'Don't make excuses, Alex. Do it right or don't do it at all.'",
                        keywords:["Fathers Voice"],
                        choices: [
                            {text:"He's still criticizing you, even in your own head.", change:1},
                            {text:"Your father isn't reading the email, Alex.", change:0},
                            {text:"You need to ignore that voice.", change:-1}
                        ]
                    },
                    {
                        text: "I look in the <span class='keyword' data-key='Mirror'>Mirror</span> and I don't see an architect. I just see a <span class='keyword' data-key='Coward'>Coward</span>. A little boy hiding under the covers.",
                        keywords:["Mirror","Coward"],
                        choices: [
                            {text:"That label 'coward' is very harsh.", change:0},
                            {text:"You are protecting yourself, not hiding.", change:2},
                            {text:"Well, hiding won't solve anything.", change:-2}
                        ]
                    },
                    {
                        text: "Maybe I should just quit. Start over somewhere where nobody knows I'm a fraud.",
                        keywords: [],
                        choices: [
                            { text: "Running away creates a new cycle.", change: 1 },
                            { text: "That seems drastic.", change: 0 },
                            { text: "And prove your father right?", change: -3 }
                        ]
                    }
                ],
                formulation: [
                    { id:1, keys:["Sick Leave","Relief"], title:"The Trap (Avoidance)" },
                    { id:2, keys:["Unsent Draft","Fathers Voice"], title:"The Block (Critic)" },
                    { id:3, keys:["Mirror","Coward"], title:"The Shame (Self-Image)" }
                ],
                outro: "Alex sees that the relief of hiding is what fuels his shame. He agrees to send the email."
            },
            {
                id: 2, client: "Alex M.", title: "The Standoff",
                briefing: "<p><strong>Update:</strong> 2 Weeks Later. Alex returned to work but feels humiliated.</p><p><strong>Goal:</strong> Navigate his hostility and projection.</p><p><strong>Warning:</strong> Rapport is Critical (1/5).</p>",
                trust: 1,
                script: [
                    {
                        text: "I did what you said. I sent the email. I went back. And you know what? It was a disaster.",
                        keywords: [],
                        choices: [
                            {text:"I'm sorry it didn't go well.", change:0},
                            {text:"Tell me what happened.", change:1},
                            {text:"You can't blame me for the outcome.", change:-1}
                        ]
                    },
                    {
                        text: "Oh, I can blame you. Halloway read my <span class='keyword' data-key='Apology'>Apology</span>, smiled, and then thanked me for being honest. Then he took me off the Skyline Project. Effectively a <span class='keyword' data-key='Demotion'>Demotion</span>.",
                        keywords:["Apology","Demotion"],
                        choices: [
                            {text:"That sounds incredibly frustrating.", change:0},
                            {text:"You feel punished for doing the right thing.", change:1},
                            {text:"He probably did it to reduce your stress.", change:-1}
                        ]
                    },
                    {
                        text: "It's worse than punishment. He treated me with <span class='keyword' data-key='Kindness'>Kindness</span>. It felt like <span class='keyword' data-key='Pity'>Pity</span>.",
                        keywords:["Kindness","Pity"],
                        choices: [
                            {text:"Why does kindness feel dangerous to you?", change:0},
                            {text:"You'd prefer he was angry.", change:1},
                            {text:"You should be grateful he wasn't angry.", change:-2}
                        ]
                    },
                    {
                        text: "I'd prefer he screamed! At least that's real. This? Everyone walking on eggshells... I can hear the <span class='keyword' data-key='Whispers'>Whispers</span>. 'Alex is <span class='keyword' data-key='Fragile'>Fragile</span>'.",
                        keywords: ["Whispers", "Fragile"],
                        choices: [
                            {text: "Are they actually whispering, or does it just feel that way?", change: -1},
                            {text: "It feels like you've been labelled.", change: 1},
                            {text: "You are feeling very exposed.", change: 0}
                        ]
                    },
                    {
                        text: "I am exposed! I showed weakness, and now I'm paying for it. That's why I'm full of <span class='keyword' data-key='Anger'>Anger</span>. It's the only <span class='keyword' data-key='Shield'>Shield</span> I have left.",
                        keywords:["Anger","Shield"],
                        choices: [
                            {text:"The anger protects you from feeling the hurt.", change:2},
                            {text:"You need to let go of the anger.", change:-1},
                            {text:"Shield against what?", change:0}
                        ]
                    },
                    {
                        text: "If I hadn't listened to you, I'd still have my pride. Now I'm just the broken guy in the corner office.",
                        keywords: [],
                        choices: [
                            { text: "Pride is a lonely comfort, Alex.", change: 1 },
                            { text: "This is part of the healing process.", change: -1 },
                            { text: "We can't change the past.", change: 0 }
                        ]
                    }
                ],
                formulation: [
                    { id:1, keys:["Apology","Demotion"], title:"Transaction (Expectation)" },
                    { id:2, keys:["Kindness","Pity"], title:"Perception (Distortion)" },
                    { id:3, keys:["Anger","Shield"], title:"Defense (Reaction)" }
                ],
                outro: "Alex realizes he is using anger to avoid feeling vulnerable. He accepts that his boss's kindness wasn't an attack."
            },
            {
                id: 3, client: "Alex M.", title: "The Blueprint",
                briefing: "<p><strong>Update:</strong> Season Finale. The boss needs Alex back for a crisis.</p><p><strong>Goal:</strong> Help Alex set boundaries instead of overworking.</p>",
                trust: 3,
                script: [
                    {
                        text: "They called me. Halloway called me personally. The Skyline project is a disaster without me. He needs me back.",
                        keywords: [],
                        choices: [
                            {text:"Be careful with that 'Hero' label.", change:0},
                            {text:"So you want to save them?", change:1},
                            {text:"You are finally getting the respect you deserve.", change:-1}
                        ]
                    },
                    {
                        text: "It feels like... justice. It's an <span class='keyword' data-key='Emergency'>Emergency</span> now. They realized I'm the only one who can be the <span class='keyword' data-key='Hero'>Hero</span> of this story.",
                        keywords:["Emergency","Hero"],
                        choices: [
                            {text:"Be careful with that 'Hero' label.", change:0},
                            {text:"So you want to save them?", change:1},
                            {text:"You are finally getting the respect you deserve.", change:-1}
                        ]
                    },
                    {
                        text: "I have to save them. I told Halloway I'd come in tonight. I'm going to pull an <span class='keyword' data-key='All-Nighter'>All-Nighter</span>. Fix the whole structural plan by morning.",
                        keywords:["All-Nighter"],
                        choices: [
                            { text: "Wow, that is dedication.", change: -2 },
                            { text: "Is that strictly necessary?", change: 0 },
                            { text: "That sounds like the old pattern talking.", change: 1 }
                        ]
                    },
                    {
                        text: "What choice do I have? If I don't give 110%, I'm just an employee. If I do this, I prove I'm indispensable. I can ignore the <span class='keyword' data-key='Burnout'>Burnout</span>.",
                        keywords:["Burnout"],
                        choices: [
                            {text:"You can't ignore the burnout forever.", change:1},
                            {text:"Maybe you should just quit then.", change:-2},
                            {text:"It's a tough choice.", change:0}
                        ]
                    },
                    {
                        text: "If I don't go back and kill myself working, then I have to quit. Those are the only two options. All or nothing.",
                        keywords: [],
                        choices: [
                            { text: "Is there a third option?", change: 1 },
                            { text: "Maybe quitting is best.", change: 0 },
                            { text: "You're being dramatic.", change: -1 }
                        ]
                    },
                    {
                        text: "A third option? Like what? Asking for... favors? That makes me look weak.",
                        keywords: [],
                        choices: [
                            { text: "Not favors. Conditions.", change: 2 },
                            { text: "Yes, ask for help.", change: 0 },
                            { text: "You are weak if you can't handle it.", change: -3 }
                        ]
                    },
                    {
                        text: "<span class='keyword' data-key='Conditions'>Conditions</span>... like telling him I'll do it, but only if I get a <span class='keyword' data-key='Team'>Team</span>? And no overtime?",
                        keywords:["Conditions","Team"],
                        choices: [
                            {text:"Exactly. You set the terms.", change:2},
                            {text:"He might say no.", change:0},
                            {text:"That sounds demanding.", change:-1}
                        ]
                    }
                ],
                formulation: [
                    { id:1, keys:["Emergency","Hero"], title:"Hook (Ego)" },
                    { id:2, keys:["All-Nighter","Burnout"], title:"Cost (Trauma)" },
                    { id:3, keys:["Conditions","Team"], title:"Blueprint (Boundaries)" }
                ],
                outro: "Alex negotiates for a team. He learns he can be a good architect without destroying himself. Season 1 Complete."
            },
            {
                id: 4, client: "Alex M.", title: "The Origin",
                briefing: "<p><strong>Update:</strong> Chapter 2 Start. A birthday phone call reopens old wounds.</p><p><strong>Goal:</strong> Trace the root of conditional love.</p>",
                trust: 3,
                script: [
                    {
                        text: "Work is good. The team is actually helping. But... my dad called yesterday. It was my <span class='keyword' data-key='Birthday'>Birthday</span>.",
                        keywords:["Birthday"],
                        choices: [
                            {text:"That sounds like it should be a happy occasion.", change:0},
                            {text:"How did the call go?", change:1},
                            {text:"Did he criticize you again?", change:-1}
                        ]
                    },
                    {
                        text: "He didn't say happy birthday. He asked if I'd got that promotion yet. When I said no, there was just... <span class='keyword' data-key='Dead Air'>Dead Air</span>. He just breathed on the line.",
                        keywords:["Dead Air"],
                        choices: [
                            {text:"That silence is louder than words.", change:1},
                            {text:"Maybe he just didn't know what to say.", change:-1},
                            {text:"He sounds like a difficult man.", change:0}
                        ]
                    },
                    {
                        text: "It reminded me of when I was 10. I wanted to be an architect even then. I drew these elaborate <span class='keyword' data-key='Blueprints'>Blueprints</span> for a treehouse.",
                        keywords:["Blueprints"],
                        choices: [
                            {text:"You were ambitious even back then.", change: 1},
                            {text:"Tell me about showing them to him.", change: 0},
                            {text:"Did he like them?", change: -1}
                        ]
                    },
                    {
                        text: "I showed him. He pointed out a structural flaw. Just one. I felt so stupid. I threw them in the <span class='keyword' data-key='Trash'>Trash</span> immediately.",
                        keywords: ["Trash"],
                        choices: [
                            {text:"You destroyed your own work before he could?", change:1},
                            {text:"Why did you do that?", change:-1},
                            {text:"That seems like an overreaction.", change:-2}
                        ]
                    },
                    {
                        text: "I tore them up. If it wasn't <span class='keyword' data-key='Perfect'>Perfect</span>, it was garbage. That was the rule in our house.",
                        keywords:["Perfect"],
                        choices: [
                            {text:"A rule he taught you?", change: 0},
                            {text:"That is an impossible standard for a child.", change: 1},
                            {text:"Perfectionism is useful sometimes.", change: -2}
                        ]
                    },
                    {
                        text: "He didn't stop me from throwing it away. He just nodded. Like he was teaching me a lesson. That affection is <span class='keyword' data-key='Earned'>Earned</span>. It's not free.",
                        keywords: ["Earned"],
                        choices: [
                            {text:"And you're still trying to earn it today.", change:2},
                            {text:"That's a cold lesson.", change:0},
                            {text:"You should call him back and tell him off.", change:-2}
                        ]
                    }
                ],
                formulation: [
                    { id:1, keys:["Birthday","Dead Air"], title:"Trigger (Rejection)" },
                    { id:2, keys:["Blueprints","Trash"], title:"Pattern (Self-Sabotage)" },
                    { id:3, keys:["Perfect","Earned"], title:"Belief (Conditionality)" }
                ],
                outro: "Alex sees the pattern: he destroys his own work to avoid his father's judgment."
            },
            {
                id: 5, client: "Alex M.", title: "The Conversation",
                briefing: "<p><strong>Update:</strong> Alex wants to confront his father.</p><p><strong>Goal:</strong> Move from accusation to vulnerability.</p>",
                trust: 3,
                script: [
                    {
                        text: "I didn't call him back. I wrote down what I wanted to say in a <span class='keyword' data-key='Script'>Script</span>. But looking at it... it reads like a declaration of war.",
                        keywords:["Script"],
                        choices: [
                            {text:"Why does honesty feel like war to you?", change:1},
                            {text:"Maybe you are just angry.", change:0},
                            {text:"You should send it anyway.", change:-1}
                        ]
                    },
                    {
                        text: "If I tell him 'You made me this way,' he'll explode. I can't handle an <span class='keyword' data-key='Explosion'>Explosion</span> right now. He'll cut me off completely.",
                        keywords:["Explosion"],
                        choices: [
                            {text:"So you stay silent to keep the peace.", change:0},
                            {text:"You are predicting a catastrophe to stop yourself from acting.", change:1},
                            {text:"Let him explode. You're an adult.", change:-1}
                        ]
                    },
                    {
                        text: "It's safer to say nothing. When we talk, I just play the role of the 'Good Son'. The real me is <span class='keyword' data-key='Invisible'>Invisible</span>.",
                        keywords:["Invisible"],
                        choices: [
                            {text:"Being invisible is safe, but it's lonely.", change:1},
                            {text:"That sounds like a good strategy for now.", change:-1},
                            {text:"Why do you hide?", change:0}
                        ]
                    },
                    {
                        text: "I want him to know. I want him to see the <span class='keyword' data-key='Cost'>Cost</span> of his parenting. The panic attacks. The sleepless nights.",
                        keywords: ["Cost"],
                        choices: [
                            {text:"You want him to feel your pain.", change:0},
                            {text:"Telling him the cost isn't about blaming him; it's about showing him *you*.", change:1},
                            {text:"He probably won't care.", change:-2}
                        ]
                    },
                    {
                        text: "But that's a huge <span class='keyword' data-key='Risk'>Risk</span>. If I show him who I am and he rejects me... then I really have no father.",
                        keywords:["Risk"],
                        choices: [
                            {text:"The risk is real. But so is the distance.", change:1},
                            {text:"You have to take the risk.", change:-1},
                            {text:"He won't reject you.", change:-1}
                        ]
                    },
                    {
                        text: "Maybe... maybe if I don't accuse him. If I just say 'I'm scared of disappointing you.' That could be a <span class='keyword' data-key='Bridge'>Bridge</span> instead of a bomb.",
                        keywords:["Bridge"],
                        choices: [
                            {text:"That is a powerful distinction.", change:2},
                            {text:"Yes, soften the blow.", change:0},
                            {text:"No, you need to be strong, not scared.", change:-2}
                        ]
                    },
                    {
                        text: "I'm going to do it. Not to change him, but just to stop hiding. That's the <span class='keyword' data-key='Truth'>Truth</span>.",
                        keywords:["Truth"],
                        choices: [
                            {text:"The truth sets you free, Alex.", change:1},
                            {text:"Good luck.", change:0},
                            {text:"Make sure you stick to the script.", change:-1}
                        ]
                    }
                ],
                formulation: [
                    { id:1, keys:["Script","Invisible"], title:"Facade (Hiding)" },
                    { id:2, keys:["Explosion","Risk"], title:"Fear (Catastrophe)" },
                    { id:3, keys:["Bridge","Truth"], title:"Path (Vulnerability)" }
                ],
                outro: "Alex decides to call his father, not to fight, but to be seen."
            },
            {
                id: 6, client: "Alex M.", title: "The Echo",
                briefing: "<p><strong>Update:</strong> The call happened. It didn't go perfectly.</p><p><strong>Goal:</strong> Process the reality of his father's limitations.</p>",
                trust: 3,
                script: [
                    {
                        text: "I called him. I said everything. I told him how scared I was of failing him.",
                        keywords: [],
                        choices: [
                            { text: "How did he respond?", change: 0 },
                            { text: "You were incredibly brave to do that.", change: 1 },
                            { text: "Did he apologize?", change: -1 }
                        ]
                    },
                    {
                        text: "He laughed. A nervous laugh. Then he said, 'I only ever wanted you to be tough, Alex. It's a tough world.' He got <span class='keyword' data-key='Defensive'>Defensive</span>.",
                        keywords:["Defensive"],
                        choices: [
                            {text:"He missed the point entirely.", change:-1},
                            {text:"His defense mechanism kicked in immediately.", change:1},
                            {text:"At least he was honest.", change:0}
                        ]
                    },
                    {
                        text: "Yeah. He started listing all the things he paid for. College, my car. Like a ledger. He couldn't hear the <span class='keyword' data-key='Emotion'>Emotion</span>.",
                        keywords: ["Emotion"],
                        choices: [
                            {text: "He responds to feelings with facts.", change: 1},
                            {text: "That is so typical of that generation.", change: -1},
                            {text: "It sounds frustrating.", change: 0}
                        ]
                    },
                    {
                        text: "I used to think he was this giant, judging god. But listening to him stutter... I just saw a <span class='keyword' data-key='Small Man'>Small Man</span> who doesn't know how to talk to his son.",
                        keywords:["Small Man"],
                        choices: [
                            {text:"The giant has shrunk.", change:2},
                            {text:"He sounds pathetic.", change:-2},
                            {text:"That's a big shift in perspective.", change:0}
                        ]
                    },
                    {
                        text: "I hung up feeling empty. No big hug. No breakthrough. Just <span class='keyword' data-key='Silence'>Silence</span> again. But it felt different this time.",
                        keywords:["Silence"],
                        choices: [
                            {text:"Different how?", change:0},
                            {text:"Because this time, you didn't cause it.", change:1},
                            {text:"You should have pushed harder.", change:-2}
                        ]
                    },
                    {
                        text: "It felt like... it wasn't my fault. He is who he is. I can't change his <span class='keyword' data-key='Limit'>Limit</span>. That's the <span class='keyword' data-key='Reality'>Reality</span>.",
                        keywords:["Limit","Reality"],
                        choices: [
                            {text:"Accepting that reality is painful but necessary.", change:1},
                            {text:"Maybe he will change later.", change:-1},
                            {text:"So you're giving up on him?", change:-2}
                        ]
                    }
                ],
                formulation: [
                    { id:1, keys:["Defensive","Emotion"], title:"Mismatch (Communication)" },
                    { id:2, keys:["Small Man","Silence"], title:"Perspective (Shift)" },
                    { id:3, keys:["Limit","Reality"], title:"Release (Acceptance)" }
                ],
                outro: "Alex accepts that his father cannot give him what he needs. He stops waiting."
            },
            {
                id: 7, client: "Alex M.", title: "The Foundation",
                briefing: "<p><strong>Update:</strong> Series Finale. Termination session.</p><p><strong>Goal:</strong> Integration and Goodbye.</p>",
                trust: 4,
                script: [
                    {
                        text: "It's been a quiet month. No panic attacks. I actually slept through the night last week.",
                        keywords: [],
                        choices: [
                            { text: "That is a huge milestone.", change: 1 },
                            { text: "Only one night?", change: -1 },
                            { text: "Sleep is important.", change: 0 }
                        ]
                    },
                    {
                        text: "I looked at my old <span class='keyword' data-key='Review'>Review</span> notes. The ones that started all this. I realized... Halloway was right about some things.",
                        keywords:["Review"],
                        choices: [
                            {text:"You can see the feedback objectively now.", change:1},
                            {text:"So you admit you were wrong?", change:-2},
                            {text:"What was he right about?", change:0}
                        ]
                    },
                    {
                        text: "He said I was 'rigid'. He was right. I was trying to control everything because I felt out of <span class='keyword' data-key='Control'>Control</span> inside.",
                        keywords:["Control"],
                        choices: [
                            {text:"Rigidity is a armor against chaos.", change:1},
                            {text:"You were a control freak.", change:-2},
                            {text:"Control is an illusion.", change:0}
                        ]
                    },
                    {
                        text: "I haven't spoken to my dad. I will, eventually. But I'm not bringing my <span class='keyword' data-key='Inner Child'>Inner Child</span> to the phone anymore. Just me.",
                        keywords:["Inner Child"],
                        choices: [
                            {text:"The adult Alex is handling it.", change:1},
                            {text:"Don't abandon the child completely.", change:0},
                            {text:"You sound detached.", change:-1}
                        ]
                    },
                    {
                        text: "I think I'm ready to stop coming here. I have the tools now. I have a new <span class='keyword' data-key='Foundation'>Foundation</span>.",
                        keywords:["Foundation"],
                        choices: [
                            {text:"I agree. You are ready.", change:1},
                            {text:"Are you sure? It's been a short time.", change:-1},
                            {text:"We can switch to monthly check-ins.", change:0}
                        ]
                    },
                    {
                        text: "Thank you, Doctor. For helping me see the difference between a boss and a father. It's time for <span class='keyword' data-key='Goodbye'>Goodbye</span>. I'm okay with the <span class='keyword' data-key='Silence'>Silence</span> now.",
                        keywords:["Goodbye","Silence"],
                        choices: [
                            {text:"You did the hard work, Alex.", change:1},
                            {text:"It's my job.", change:0},
                            {text:"Good luck.", change:0}
                        ]
                    }
                ],
                formulation: [
                    { id:1, keys:["Review","Control"], title:"Insight (Integration)" },
                    { id:2, keys:["Inner Child","Foundation"], title:"Growth (Stability)" },
                    { id:3, keys:["Goodbye","Silence"], title:"Future (Autonomy)" }
                ],
                outro: "Alex walks out the door. He is no longer seeking permission to exist. Case Closed."
            },

            // --- ELENA R (8-15) ---
            {
                id: 8, client: "Elena R.", title: "The Diet",
                briefing: "<p><strong>Subject:</strong> Elena R. (20)<br><strong>Occupation:</strong> Ballet Student<br><strong>Issue:</strong> Severe caloric restriction. Denial of illness.</p><p><strong>Goal:</strong> Penetrate the rationalization of her disorder.</p>",
                trust: 2,
                script: [
                    { text: "My mom is overreacting. It's not a 'disorder'. In the dance world, this is just a <span class='keyword' data-key='Lifestyle'>Lifestyle</span>.", keywords: ["Lifestyle"], choices: [{text:"So it feels normal to you.", change:1}, {text:"Your mom is just worried.", change:-1}, {text:"It sounds dangerous.", change:-1}] },
                    { text: "Look at the other girls. We all skip meals. It shows <span class='keyword' data-key='Dedication'>Dedication</span>. If you aren't thin, you don't get the part.", keywords: ["Dedication"], choices: [{text:"You work very hard for your art.", change:1}, {text:"Is it worth it?", change:0}, {text:"That's not dedication, it's sickness.", change:-2}] },
                    { text: "Mom says I'm <span class='keyword' data-key='Starving'>Starving</span> myself. She doesn't get it. It's not about food.", keywords: ["Starving"], choices: [{text:"That word 'starving' feels aggressive to you.", change:1}, {text:"Are you hungry?", change:0}, {text:"She's right, you know.", change:-1}] },
                    { text: "It's about feeling <span class='keyword' data-key='Pure'>Pure</span>. When I'm empty, I feel light. I feel better.", keywords: ["Pure"], choices: [{text:"Purity... that's a powerful feeling.", change:1}, {text:"Pure like clean?", change:0}, {text:"Empty isn't pure, it's empty.", change:-1}] },
                    { text: "Okay, sometimes I get <span class='keyword' data-key='Dizzy'>Dizzy</span>. I blacked out once in rehearsal. But I just need to be stronger.", keywords: ["Dizzy"], choices: [{text:"Your body is sending you signals.", change:1}, {text:"That sounds dangerous.", change:0}, {text:"You fainted? I'm calling your mom.", change:-2}] },
                    { text: "This is the only thing I can <span class='keyword' data-key='Control'>Control</span>. School, my parents... it's all chaos. This is mine.", keywords: ["Control"], choices: [{text:"It's a way to create order in the chaos.", change:2}, {text:"What else can't you control?", change:0}, {text:"You can't control everything.", change:-1}] }
                ],
                formulation: [
                    { id:1, keys:["Lifestyle","Dedication"], title:"The Mask (Normalization)" },
                    { id:2, keys:["Starving","Pure"], title:"The Distortion (Meaning)" },
                    { id:3, keys:["Dizzy","Control"], title:"The Paradox (Cost)" }
                ],
                outro: "Elena looks down at her hands. 'I thought I was driving the car,' she whispers. 'But maybe the car is driving me.'<br><br>The seed of doubt is planted. She agrees to come back next week."
            },
            {
                id: 9, client: "Elena R.", title: "The Trigger",
                briefing: "<p><strong>Subject:</strong> Elena R. (20)<br><strong>Timeline:</strong> 1 Week Later.<br><strong>Topic:</strong> Origins.</p><p><strong>Goal:</strong> Identify the specific event that triggered the behavior.</p><p><strong>Warning:</strong> Rapport is Guarded (2/5).</p>",
                trust: 2,
                script: [
                    {
                        text: "I thought about what you said. About 'driving the car'. You think I lost control. But I remember exactly when I took the wheel.",
                        keywords: [],
                        choices: [
                            {text:"Tell me about that moment.", change:1},
                            {text:"You're still in denial.", change:-2},
                            {text:"When was this?", change:0}
                        ]
                    },
                    {
                        text: "I was 14. The Nutcracker auditions. I was fitted for the Clara <span class='keyword' data-key='Costume'>Costume</span>. It was beautiful. White silk.",
                        keywords: ["Costume"],
                        choices: [
                            {text:"That sounds like a core memory.", change:1},
                            {text:"Did it fit?", change:0},
                            {text:"What went wrong?", change:-1}
                        ]
                    },
                    {
                        text: "The mistress zipped it up. It was tight. She didn't say anything. She just reached out and did this... <span class='keyword' data-key='Pinch'>Pinch</span>. On my waist.",
                        keywords: ["Pinch"],
                        choices: [
                            {text:"That was a violation of your space.", change:1},
                            {text:"Just a pinch?", change:-1},
                            {text:"How did you react?", change:0}
                        ]
                    },
                    {
                        text: "Everyone saw. The other girls giggled. I burned with shame. That night at dinner, I learned a trick. I used a <span class='keyword' data-key='Napkin'>Napkin</span> to hide the meat.",
                        keywords: ["Napkin"],
                        choices: [
                            {text:"You wanted to disappear.", change:1},
                            {text:"That's a classic trick.", change:-1}, // Too clinical
                            {text:"Did your parents notice?", change:0}
                        ]
                    },
                    {
                        text: "They didn't notice. I drank three glasses of <span class='keyword' data-key='Water'>Water</span> to feel full. It worked. The hunger pangs went away.",
                        keywords: ["Water"],
                        choices: [
                            {text:"You numbed the physical sensation.", change:0},
                            {text:"You found a way to cope with the shame.", change:1},
                            {text:"That is very unhealthy.", change:-2}
                        ]
                    },
                    {
                        text: "The next morning, I woke up with this gnawing <span class='keyword' data-key='Hunger'>Hunger</span>. But I looked in the mirror, and I didn't feel weak. I felt <span class='keyword' data-key='Victory'>Victory</span>.",
                        keywords: ["Hunger", "Victory"],
                        choices: [
                            {text:"The hunger felt like an achievement.", change:2},
                            {text:"That's a dangerous association.", change:-1},
                            {text:"Victory over what?", change:0}
                        ]
                    }
                ],
                formulation: [
                    { id:1, keys:["Costume","Pinch"], title:"The Event (Shame)" },
                    { id:2, keys:["Napkin","Water"], title:"The Method (Concealment)" },
                    { id:3, keys:["Hunger","Victory"], title:"The Reward (Reframing)" }
                ],
                outro: "Elena stares at the wall. 'I won that role,' she says. 'So it worked.'<br><br>You gently point out that the 14-year-old girl is still in charge, still trying to avoid that pinch. Elena goes silent."
            },
            {
                id: 10, client: "Elena R.", title: "The Rules",
                briefing: "<p><strong>Subject:</strong> Elena R. (20)<br><strong>Timeline:</strong> 1 Week Later.<br><strong>Topic:</strong> The Daily Routine.</p><p><strong>Goal:</strong> Map the rigid system keeping the disorder in place.</p><p><strong>Status:</strong> Rapport is Neutral (3/5).</p>",
                trust: 3,
                script: [
                    {
                        text: "It didn't stop with the Nutcracker. That was just the start. Now, my life is... organized.",
                        keywords: [],
                        choices: [
                            {text:"Organized, or rigid?", change:0},
                            {text:"Tell me about your routine.", change:1},
                            {text:"You mean obsessive.", change:-2}
                        ]
                    },
                    {
                        text: "I wake up at 5 AM. I step on the <span class='keyword' data-key='Scale'>Scale</span>. That little digital <span class='keyword' data-key='Number'>Number</span> decides if I'm allowed to be happy today.",
                        keywords: ["Scale", "Number"],
                        choices: [
                            {text:"You give a machine a lot of power.", change:1},
                            {text:"Numbers don't define you.", change:0}, // True but clich√©
                            {text:"You should throw the scale away.", change:-1}
                        ]
                    },
                    {
                        text: "If the number is 'bad', the rules get tighter. No lunch. Only <span class='keyword' data-key='Safe Foods'>Safe Foods</span>. Celery. Black coffee. Things that don't count.",
                        keywords: ["Safe Foods"],
                        choices: [
                            {text:"Safety implies danger. What is dangerous about food?", change:1},
                            {text:"You need protein.", change:-1},
                            {text:"It sounds exhausting.", change:0}
                        ]
                    },
                    {
                        text: "If I slip up... if I eat a bagel... I feel dirty. Like I'm in <span class='keyword' data-key='Debt'>Debt</span>. I have to pay it back immediately.",
                        keywords: ["Debt"],
                        choices: [
                            {text:"How do you pay it back?", change:0},
                            {text:"Your body isn't a bank.", change:1},
                            {text:"That's guilt, not debt.", change:-1}
                        ]
                    },
                    {
                        text: "I go <span class='keyword' data-key='Running'>Running</span>. Five miles. Ten. Until the calorie counter hits zero. Until the debt is cleared.",
                        keywords: ["Running"],
                        choices: [
                            {text:"You're using exercise as punishment.", change:1},
                            {text:"At least you're active.", change:-2}, // Dangerous validation
                            {text:"That's a lot of running.", change:0}
                        ]
                    },
                    {
                        text: "It keeps the chaos away. These <span class='keyword' data-key='Rules'>Rules</span>... they protect me. But sometimes, late at night, I feel like I'm in a <span class='keyword' data-key='Cage'>Cage</span>.",
                        keywords: ["Rules", "Cage"],
                        choices: [
                            {text:"The protection has become a prison.", change:2},
                            {text:"You built the cage.", change:-1},
                            {text:"Let's talk about unlocking it.", change:1}
                        ]
                    }
                ],
                formulation: [
                    { id:1, keys:["Scale","Number"], title:"The Judge (Monitoring)" },
                    { id:2, keys:["Running","Debt"], title:"The Transaction (Punishment)" },
                    { id:3, keys:["Rules","Cage"], title:"The Paradox (Isolation)" }
                ],
                outro: "Elena looks tired. 'I thought the rules made me strong,' she admits. 'But I'm just tired of counting.'<br><br>She recognizes that her 'organization' is actually a trap."
            },
            {
                id: 11, client: "Elena R.", title: "The Collapse",
                briefing: "<p><strong>Subject:</strong> Elena R. (20)<br><strong>Timeline:</strong> 3 Days Later.<br><strong>Incident:</strong> Hospitalization after fainting.</p><p><strong>Goal:</strong> Break through the denial of physical danger.</p><p><strong>Status:</strong> Critical (3/5).</p>",
                trust: 3,
                script: [
                    {
                        text: "I'm back. The hospital released me. They said it was just dehydration. I'm fine.",
                        keywords: [],
                        choices: [
                            {text:"You ended up in the ER, Elena. That is not fine.", change:1},
                            {text:"I'm glad you're okay.", change:0},
                            {text:"You are lying to yourself.", change:-1}
                        ]
                    },
                    {
                        text: "Okay, they said my heart beat was irregular. My chart said <span class='keyword' data-key='Critical'>Critical</span>. But athletes have slow hearts, right?",
                        keywords: ["Critical"],
                        choices: [
                            {text:"That wasn't athletic conditioning. That was your body shutting down.", change:1},
                            {text:"Maybe you should see a specialist.", change:0},
                            {text:"You almost died.", change:-1}
                        ]
                    },
                    {
                        text: "When I woke up in the bed, looking at the IV... I didn't feel scared. I felt <span class='keyword' data-key='Superior'>Superior</span>. Like I was winning a game no one else could play.",
                        keywords: ["Superior"],
                        choices: [
                            {text:"Feeling superior while dying is the disorder talking.", change:1},
                            {text:"Winning what exactly?", change:0},
                            {text:"That is delusional.", change:-2}
                        ]
                    },
                    {
                        text: "My dance teacher visited. She didn't praise my dedication. She looked... <span class='keyword' data-key='Horrified'>Horrified</span>.",
                        keywords: ["Horrified"],
                        choices: [
                            {text:"She saw the reality, not the fantasy.", change:1},
                            {text:"She probably just cares about you.", change:0},
                            {text:"She should be horrified.", change:-1}
                        ]
                    },
                    {
                        text: "I thought I was perfecting my body. But in her eyes, I saw a <span class='keyword' data-key='Skeleton'>Skeleton</span>. Is that what I really look like?",
                        keywords: ["Skeleton"],
                        choices: [
                            {text:"Yes. You are disappearing.", change:1},
                            {text:"You look very thin.", change:0},
                            {text:"The mirror has been lying to you.", change:1}
                        ]
                    },
                    {
                        text: "This isn't a lifestyle, is it? It's a <span class='keyword' data-key='Monster'>Monster</span>. I don't want to die. But I don't know how to <span class='keyword' data-key='Live'>Live</span> without it.",
                        keywords: ["Monster", "Live"],
                        choices: [
                            {text:"We can teach you how to live. But first, you have to choose life.", change:2},
                            {text:"Just eat something.", change:-2},
                            {text:"It will be hard work.", change:0}
                        ]
                    }
                ],
                formulation: [
                    { id:1, keys:["Critical","Superior"], title:"The Delusion (Mindset)" },
                    { id:2, keys:["Horrified","Skeleton"], title:"The Mirror (Reality)" },
                    { id:3, keys:["Monster","Live"], title:"The Diagnosis (Acceptance)" }
                ],
                outro: "Elena starts to cry, finally letting go of the control. 'I need help,' she whispers.<br><br><strong>CHAPTER 1 COMPLETE.</strong><br>Elena has accepted her diagnosis. The road to recovery begins in Chapter 2."
            },
            {
                id: 12, client: "Elena R.", title: "The Bargain",
                briefing: "<p><strong>Subject:</strong> Elena R. (20)<br><strong>Timeline:</strong> 1 Week Later.<br><strong>Topic:</strong> Quasi-Recovery.</p><p><strong>Goal:</strong> Identify how she is bargaining with the disorder.</p><p><strong>Status:</strong> Rapport is Guarded (2/5).</p>",
                trust: 2,
                script: [
                    { text: "I'm doing better. I'm eating. I had a sandwich for lunch. See? I'm compliant.", keywords: [], choices: [{text:"That's a good step.", change:0}, {text:"You sound like you're trying to convince me.", change:1}, {text:"What was in the sandwich?", change:-1}] },
                    { text: "I ate the whole thing. But then I felt... heavy. So I walked home the long way. Just <span class='keyword' data-key='Movement'>Movement</span>. It helps me focus.", keywords: ["Movement"], choices: [{text:"You're trading one rule for another.", change:1}, {text:"Exercise is good for you.", change:-2}, {text:"How long was the walk?", change:0}] },
                    { text: "It's just walking! I'm allowed to walk. As long as I show <span class='keyword' data-key='Compliance'>Compliance</span> with the meal plan, I can do what I want with my time.", keywords: ["Compliance"], choices: [{text:"You see recovery as a negotiation.", change:1}, {text:"That's not how it works.", change:-1}, {text:"Technically true.", change:0}] },
                    { text: "I just can't stand the feeling of <span class='keyword' data-key='Fullness'>Fullness</span>. It feels like... failure. Like I'm lazy.", keywords: ["Fullness"], choices: [{text:"Fullness is a biological signal, not a moral failing.", change:1}, {text:"You'll get used to it.", change:0}, {text:"Lazy people don't dance ballet.", change:0}] },
                    { text: "When I'm full, I feel <span class='keyword' data-key='Panic'>Panic</span> rising in my throat. Moving is the only way to push it down.", keywords: ["Panic"], choices: [{text:"So the movement isn't about fitness, it's about anxiety.", change:1}, {text:"You need to sit with the panic.", change:0}, {text:"Have you tried breathing exercises?", change:0}] },
                    { text: "Okay, maybe it is a <span class='keyword' data-key='Negotiation'>Negotiation</span>. If I eat, I have to move. If I move, I'm allowed to eat. It's the only way I can handle the <span class='keyword' data-key='Restriction'>Restriction</span> of my freedom.", keywords: ["Negotiation", "Restriction"], choices: [{text:"The disorder is still dictating the terms.", change:2}, {text:"That sounds fair.", change:-2}, {text:"We need to break that contract.", change:0}] }
                ],
                formulation: [
                    { id:1, keys:["Compliance","Movement"], title:"The Loophole (Action)" },
                    { id:2, keys:["Fullness","Panic"], title:"The Fear (Sensation)" },
                    { id:3, keys:["Negotiation","Restriction"], title:"The Truth (Control)" }
                ],
                outro: "Elena crosses her arms. 'I thought I was being good,' she says defensively. 'But I guess I'm just being sneaky.'<br><br>She realizes that bargaining is just another form of the disorder."
            },
            {
                id: 13, client: "Elena R.", title: "The Voice",
                briefing: "<p><strong>Subject:</strong> Elena R. (20)<br><strong>Timeline:</strong> 1 Week Later.<br><strong>Topic:</strong> Dysmorphia.</p><p><strong>Goal:</strong> Separate her identity from the 'Anorexic Voice'.</p><p><strong>Status:</strong> Rapport is Low (2/5).</p>",
                trust: 2,
                script: [
                    { text: "I can't do this anymore. I gained two pounds. I feel disgusting.", keywords: [], choices: [{text:"Two pounds is progress.", change:-1}, {text:"Disgusting is a strong word.", change:0}, {text:"Tell me about that feeling.", change:1}] },
                    { text: "I looked in the <span class='keyword' data-key='Mirror'>Mirror</span> this morning. I look huge. My face is swollen. I look like a balloon.", keywords: ["Mirror"], choices: [{text:"That is the dysmorphia talking.", change:1}, {text:"You look healthy to me.", change:-2}, {text:"It takes time to adjust.", change:0}] },
                    { text: "It's not just my eyes. It's my head. The thoughts are so loud. They're like a <span class='keyword' data-key='Parasite'>Parasite</span> eating my brain.", keywords: ["Parasite"], choices: [{text:"Let's name that parasite.", change:1}, {text:"You need to ignore them.", change:-1}, {text:"What do they say?", change:0}] },
                    { text: "They scream at me. 'You're fat. You're weak. You're ruining everything.' These <span class='keyword' data-key='Thoughts'>Thoughts</span> don't feel like mine.", keywords: ["Thoughts"], choices: [{text:"If they don't feel like yours, whose are they?", change:1}, {text:"That sounds overwhelming.", change:0}, {text:"Try positive affirmations.", change:-1}] },
                    { text: "It feels like a <span class='keyword' data-key='Funhouse'>Funhouse</span>. Everything is distorted. I don't know what's real anymore.", keywords: ["Funhouse"], choices: [{text:"The mirror is lying to you.", change:1}, {text:"Trust the scale, not the mirror.", change:-1}, {text:"Reality is subjective.", change:0}] },
                    { text: "I want to crawl out of my skin. The <span class='keyword' data-key='Discomfort'>Discomfort</span> is unbearable. I just want to feel <span class='keyword' data-key='Safety'>Safety</span> again.", keywords: ["Discomfort", "Safety"], choices: [{text:"Safety for you has meant starvation. We need to find a new safety.", change:2}, {text:"You are safe here.", change:0}, {text:"Discomfort is part of growth.", change:0}] }
                ],
                formulation: [
                    { id:1, keys:["Thoughts","Parasite"], title:"The Intruder (Voice)" },
                    { id:2, keys:["Mirror","Funhouse"], title:"The Distortion (Perception)" },
                    { id:3, keys:["Discomfort","Safety"], title:"The Strategy (Endurance)" }
                ],
                outro: "Elena closes her eyes. 'It's not me talking,' she says. 'It's It.'<br><br>She begins to separate her self from the disorder. The enemy is now externalized."
            },
            {
                id: 14, client: "Elena R.", title: "The Slip",
                briefing: "<p><strong>Subject:</strong> Elena R. (20)<br><strong>Timeline:</strong> 1 Week Later.<br><strong>Topic:</strong> Relapse.</p><p><strong>Goal:</strong> Reframe relapse as data, not failure.</p><p><strong>Status:</strong> Rapport is Critical (1/5).</p>",
                trust: 1,
                script: [
                    { text: "I messed up. I shouldn't even be here. I'm wasting your time.", keywords: [], choices: [{text:"You're never wasting my time.", change:1}, {text:"What happened?", change:0}, {text:"Did you relapse?", change:-1}] },
                    { text: "I had an audition. The director cut me after the first round. It felt like a total <span class='keyword' data-key='Rejection'>Rejection</span> of everything I am.", keywords: ["Rejection"], choices: [{text:"That must have hurt deeply.", change:1}, {text:"It's just one audition.", change:-1}, {text:"Rejection is part of dance.", change:0}] },
                    { text: "I went home and I just... didn't eat. It wasn't a decision. It was a <span class='keyword' data-key='Habit'>Habit</span>. Like muscle memory.", keywords: ["Habit"], choices: [{text:"Stress triggered the old pathway.", change:1}, {text:"You were doing so well.", change:-1}, {text:"It happens.", change:0}] },
                    { text: "But now I've ruined it. One <span class='keyword' data-key='Slip'>Slip</span> and I'm back to zero. I might as well stop trying.", keywords: ["Slip"], choices: [{text:"A slip is not a fall.", change:1}, {text:"Don't be dramatic.", change:-2}, {text:"You haven't lost your progress.", change:0}] },
                    { text: "I feel like such a <span class='keyword' data-key='Failure'>Failure</span>. I promised myself I wouldn't do this.", keywords: ["Failure"], choices: [{text:"Shame is the disorder's way of keeping you trapped.", change:1}, {text:"You failed one meal, not your recovery.", change:1}, {text:"You need to try harder.", change:-2}] },
                    { text: "So what do I do? Just pretend it didn't happen? It was a huge <span class='keyword' data-key='Mistake'>Mistake</span>.", keywords: ["Mistake"], choices: [{text:"It's not a mistake. It's Data. What did we learn?", change:2}, {text:"Yes, move on.", change:0}, {text:"Do you need to punish yourself?", change:-2}] },
                    { text: "<span class='keyword' data-key='Data'>Data</span>... I guess if I look at it like that, it's just information. Not a character flaw.", keywords: ["Data"], choices: [{text:"Exactly. We use it to plan for next time.", change:1}, {text:"Now you get it.", change:0}, {text:"Don't do it again.", change:-1}] }
                ],
                formulation: [
                    { id:1, keys:["Rejection","Habit"], title:"The Trigger (Stress)" },
                    { id:2, keys:["Slip","Failure"], title:"The Judgment (Shame)" },
                    { id:3, keys:["Mistake","Data"], title:"The Pivot (Learning)" }
                ],
                outro: "Elena wipes her eyes. 'Data,' she repeats. 'Okay. The data says stress makes me want to disappear.'<br><br>She stops the shame spiral. She commits to eating dinner tonight."
            },
            {
                id: 15, client: "Elena R.", title: "The Table",
                briefing: "<p><strong>Subject:</strong> Elena R. (20)<br><strong>Timeline:</strong> 1 Week Later.<br><strong>Topic:</strong> Social Eating.</p><p><strong>Goal:</strong> Integration and Courage.</p><p><strong>Status:</strong> Rapport is High (4/5).</p>",
                trust: 4,
                script: [
                    { text: "I did it. I ate dinner. And I didn't run afterwards.", keywords: [], choices: [{text:"That is incredible strength.", change:1}, {text:"Was it hard?", change:0}, {text:"Good girl.", change:-2}] },
                    { text: "It was awful. I was shaking. But I invited my mom. I couldn't do it in <span class='keyword' data-key='Isolation'>Isolation</span> anymore.", keywords: ["Isolation"], choices: [{text:"You let someone in.", change:1}, {text:"Your mom must have been happy.", change:0}, {text:"Why your mom?", change:0}] },
                    { text: "She just sat there. She didn't stare. It was the first real <span class='keyword' data-key='Connection'>Connection</span> we've had in years.", keywords: ["Connection"], choices: [{text:"The disorder was a wall between you.", change:1}, {text:"That sounds nice.", change:0}, {text:"Family is important.", change:0}] },
                    { text: "I was terrified. The <span class='keyword' data-key='Fear'>Fear</span> was screaming at me to stop. But I kept lifting the fork.", keywords: ["Fear"], choices: [{text:"Courage is acting despite the fear.", change:1}, {text:"You shouldn't be afraid of food.", change:-1}, {text:"You fought back.", change:1}] },
                    { text: "I realized... <span class='keyword' data-key='Eating'>Eating</span> isn't just fuel. It's... participating in life.", keywords: ["Eating"], choices: [{text:"Yes. It's saying 'I deserve to be here'.", change:1}, {text:"Food is just food.", change:0}, {text:"Don't overthink it.", change:-1}] },
                    { text: "I don't know if I'm 'cured'. The voice is still there. But <span class='keyword' data-key='Recovery'>Recovery</span> isn't a feeling, is it? It's a <span class='keyword' data-key='Choice'>Choice</span>.", keywords: ["Recovery", "Choice"], choices: [{text:"And you are making that choice, every day.", change:2}, {text:"You'll feel better soon.", change:0}, {text:"It gets easier.", change:0}] }
                ],
                formulation: [
                    { id:1, keys:["Isolation","Connection"], title:"The Support (Vulnerability)" },
                    { id:2, keys:["Fear","Eating"], title:"The Action (Courage)" },
                    { id:3, keys:["Recovery","Choice"], title:"The Future (Agency)" }
                ],
                outro: "Elena stands up, looking stronger than she has in weeks.<br><br>'I'm going to lunch with the other dancers,' she says. 'I might be scared, but I'm going.'<br><br><strong>CASE CLOSED.</strong>"
            },

            // --- SARAH T (16-19) ---
            {
                id: 16, client: "Sarah T.", title: "The Accident",
                briefing: "<p><strong>Subject:</strong> Sarah T. (34)<br><strong>Occupation:</strong> Stay-at-home Mom<br><strong>Issue:</strong> Generalized Anxiety.<br><strong>Note:</strong> Client has a visible bruise on her cheek, concealed with makeup.</p><p><strong>Goal:</strong> Gently investigate the source of the injury without triggering defensive withdrawal.</p>",
                trust: 3,
                script: [
                    { text: "I feel silly being here. My life is great, really. Mark is a wonderful provider. I'm just... anxious lately.", keywords: [], choices: [{text:"It's okay to seek help even when things are 'great'.", change:1}, {text:"You seem nervous.", change:0}, {text:"What happened to your face?", change:-2}] }, // Direct confrontation lowers trust immediately
                    { text: "Oh, this? I'm just so <span class='keyword' data-key='Clumsy'>Clumsy</span>. I wasn't looking where I was going.", keywords: ["Clumsy"], choices: [{text:"Accidents happen.", change:0}, {text:"That looks painful.", change:1}, {text:"You don't seem clumsy.", change:0}] },
                    { text: "I walked right into the <span class='keyword' data-key='Door'>Door</span> frame in the middle of the night. It was dark. So stupid of me.", keywords: ["Door"], choices: [{text:"Darkness can be disorienting.", change:0}, {text:"A door frame did that?", change:0}, {text:"It happens.", change:0}] },
                    { text: "Mark was so upset. He's under a lot of <span class='keyword' data-key='Stress'>Stress</span> at the bank right now. Layoffs, you know?", keywords: ["Stress"], choices: [{text:"Does his stress affect you?", change:1}, {text:"He shouldn't take it out on you.", change:-1}, {text:"Work stress is hard.", change:0}] },
                    { text: "I shouldn't have bothered him. He was working in the study and I kept asking about dinner. I was <span class='keyword' data-key='Nagging'>Nagging</span> him.", keywords: ["Nagging"], choices: [{text:"Asking about dinner isn't nagging.", change:1}, {text:"You blame yourself.", change:1}, {text:"So he hit you because you nagged?", change:-2}] }, // Confrontation is dangerous
                    { text: "He felt terrible afterwards. He cried. He brought me these beautiful <span class='keyword' data-key='Flowers'>Flowers</span> the next morning.", keywords: ["Flowers"], choices: [{text:"He tried to make it up to you.", change:0}, {text:"Gifts often follow these moments.", change:1}, {text:"Flowers don't fix bruises.", change:-1}] }, // Too cynical too fast
                    { text: "He said he was <span class='keyword' data-key='Sorry'>Sorry</span>. He promised it wouldn't happen again. He loves me so much.", keywords: ["Sorry"], choices: [{text:"You want to believe him.", change:1}, {text:"Actions speak louder than words.", change:0}, {text:"Do you believe him?", change:0}] }
                ],
                formulation: [
                    { id:1, keys:["Clumsy","Door"], title:"The Cover Story (Denial)" },
                    { id:2, keys:["Stress","Nagging"], title:"The Justification (Self-Blame)" },
                    { id:3, keys:["Flowers","Sorry"], title:"The Cycle (Reconciliation)" }
                ],
                outro: "Sarah touches her cheek subconsciously. 'It was just an accident,' she whispers, more to herself than to you.<br><br>She isn't ready to call it abuse yet, but the seed of doubt is planted."
            },
            {
                id: 17, client: "Sarah T.", title: "The Pattern",
                briefing: "<p><strong>Subject:</strong> Sarah T. (34)<br><strong>Timeline:</strong> 1 Week Later.<br><strong>Topic:</strong> Home Environment.</p><p><strong>Goal:</strong> Challenge the normalization of fear in her daily life.</p><p><strong>Status:</strong> Rapport is Guarded (2/5).</p>",
                trust: 2,
                script: [
                    { text: "Things are better this week. Mark has been calm. I've been making sure everything is perfect for him.", keywords: [], choices: [{text:"It sounds like you're working hard to keep the peace.", change:1}, {text:"Perfect is a high standard.", change:0}, {text:"Are you afraid he'll get angry again?", change:-1}] },
                    { text: "I just keep the house <span class='keyword' data-key='Quiet'>Quiet</span> when he gets home. If the kids are loud, it sets him off. That's reasonable, right?", keywords: ["Quiet"], choices: [{text:"It's considerate, but is it necessary?", change:0}, {text:"You are managing his emotions for him.", change:1}, {text:"Kids are allowed to be loud.", change:-1}] },
                    { text: "I feel this... <span class='keyword' data-key='Tension'>Tension</span> in my chest from 5 PM until he goes to sleep. But that's just being a wife.", keywords: ["Tension"], choices: [{text:"That tension is your body signaling danger.", change:1}, {text:"Walking on eggshells isn't a marriage requirement.", change:1}, {text:"That sounds miserable.", change:-2}] },
                    { text: "He didn't touch me this week. He got mad at the TV and punched the <span class='keyword' data-key='Wall'>Wall</span> next to my head. But he didn't hit *me*.", keywords: ["Wall"], choices: [{text:"Violence against the room is still violence.", change:1}, {text:"That was a threat, Sarah.", change:0}, {text:"He's out of control.", change:-1}] },
                    { text: "It was just <span class='keyword' data-key='Shouting'>Shouting</span>. Men get loud. My father used to shout too. It doesn't mean anything.", keywords: ["Shouting"], choices: [{text:"Does the shouting make you feel safe?", change:1}, {text:"It means he is using fear to control you.", change:-1}, {text:"Just because it's familiar doesn't mean it's safe.", change:1}] },
                    { text: "Every couple fights. This is just <span class='keyword' data-key='Normal'>Normal</span>. I don't want to make a big deal out of his work <span class='keyword' data-key='Stress'>Stress</span>.", keywords: ["Normal", "Stress"], choices: [{text:"Fear is not a normal part of love.", change:2}, {text:"Stop making excuses for him.", change:-2}, {text:"Stress explains it, but it doesn't excuse it.", change:1}] }
                ],
                formulation: [
                    { id:1, keys:["Quiet","Tension"], title:"The Atmosphere (Fear)" },
                    { id:2, keys:["Wall","Shouting"], title:"The Escalation (Intimidation)" },
                    { id:3, keys:["Normal","Stress"], title:"The Denial (Rationalization)" }
                ],
                outro: "Sarah looks down at her hands. 'I'm scared all the time,' she admits quietly. 'Even when he's happy.'<br><br>She has acknowledged the fear. The illusion of 'normal' is breaking."
            },
            {
                id: 18, client: "Sarah T.", title: "The Prince",
                briefing: "<p><strong>Subject:</strong> Sarah T. (34)<br><strong>Timeline:</strong> 1 Week Later.<br><strong>Topic:</strong> Relationship History.</p><p><strong>Goal:</strong> Trace the path from romance to isolation.</p><p><strong>Status:</strong> Rapport is Neutral (3/5).</p>",
                trust: 3,
                script: [
                    { text: "You have to understand, he wasn't always like this. When we met, it was like a movie.", keywords: [], choices: [{text:"Tell me about the beginning.", change:1}, {text:"Abusers are often charming at first.", change:-2}, {text:"How did you meet?", change:0}] },
                    { text: "He swept me off my feet. He sent flowers to my work every day. He told me I was his <span class='keyword' data-key='Soulmate'>Soulmate</span> after two weeks.", keywords: ["Soulmate"], choices: [{text:"That is very intense, very fast.", change:1}, {text:"That sounds romantic.", change:0}, {text:"That's a red flag.", change:-1}] },
                    { text: "He wanted to be with me <span class='keyword' data-key='Everywhere'>Everywhere</span>. He picked me up, dropped me off. He couldn't bear to be apart.", keywords: ["Everywhere"], choices: [{text:"It felt good to be wanted.", change:0}, {text:"It sounds like he was monitoring you.", change:1}, {text:"Did you have space to breathe?", change:-1}] },
                    { text: "My <span class='keyword' data-key='Friends'>Friends</span> didn't get it. They said he was too much. But Mark said they were just <span class='keyword' data-key='Jealous'>Jealous</span> of our love.", keywords: ["Friends", "Jealous"], choices: [{text:"He pitted you against them.", change:1}, {text:"Maybe they saw something you didn't.", change:0}, {text:"He was isolating you.", change:-2}] },
                    { text: "He said they were a bad influence. That they didn't respect me like he did. He just wanted to <span class='keyword' data-key='Protect'>Protect</span> me.", keywords: ["Protect"], choices: [{text:"Protection and control can look very similar.", change:2}, {text:"From your own friends?", change:0}, {text:"He was manipulating you.", change:-1}] },
                    { text: "So I stopped seeing them. It was easier. Now it's just him and me. Sometimes I feel <span class='keyword' data-key='Alone'>Alone</span>, but... at least I'm loved.", keywords: ["Alone"], choices: [{text:"You can be loved and still be lonely.", change:1}, {text:"Are you loved, or owned?", change:1}, {text:"You need to call your friends.", change:-1}] }
                ],
                formulation: [
                    { id:1, keys:["Soulmate","Everywhere"], title:"The Hook (Love Bombing)" },
                    { id:2, keys:["Friends","Jealous"], title:"The Wedge (Isolation)" },
                    { id:3, keys:["Protect","Alone"], title:"The Trap (Dependency)" }
                ],
                outro: "Sarah pauses. 'I haven't spoken to my best friend in three years,' she says. 'He told me she hated me... but maybe he just hated that she asked questions.'<br><br>She begins to see the isolation as a tactic, not a byproduct of love."
            },
            {
                id: 19, client: "Sarah T.", title: "The Visit",
                briefing: "<p><strong>Subject:</strong> Sarah T. (34)<br><strong>Timeline:</strong> 3 Days Later (Urgent).<br><strong>Incident:</strong> Police were called to the home.<br><strong>Goal:</strong> Acknowledge the danger without forcing a premature exit.</p><p><strong>Status:</strong> Rapport is Fragile (3/5).</p>",
                trust: 3,
                script: [
                    { text: "I shouldn't have come. If he knows I'm here... The neighbors called the <span class='keyword' data-key='Police'>Police</span> last night.", keywords: ["Police"], choices: [{text:"That must have been terrifying.", change:1}, {text:"Good. They needed to be called.", change:-2}, {text:"What did you tell them?", change:0}] },
                    { text: "I told them it was the TV. I <span class='keyword' data-key='Lied'>Lied</span>. I had to. Mark was standing right there behind the door.", keywords: ["Lied"], choices: [{text:"You did what you had to do to stay safe.", change:1}, {text:"Lying to the police is a crime.", change:-2}, {text:"Why protect him?", change:-1}] },
                    { text: "After they left... he wasn't mad. He was <span class='keyword' data-key='Silent'>Silent</span>. That's worse than the yelling. The silence is a threat.", keywords: ["Silent"], choices: [{text:"You are waiting for the other shoe to drop.", change:1}, {text:"Silence isn't violence.", change:-1}, {text:"He's manipulating you.", change:0}] },
                    { text: "Then this morning, he made breakfast. Pancakes. He was acting like the <span class='keyword' data-key='Perfect Husband'>Perfect Husband</span>. It makes me feel crazy.", keywords: ["Perfect Husband"], choices: [{text:"It's called 'gaslighting'.", change:0}, {text:"The shift confuses your reality.", change:1}, {text:"Maybe he's sorry.", change:-1}] },
                    { text: "I can't leave him. He controls the <span class='keyword' data-key='Money'>Money</span>. If I leave, I have nothing. I lose the kids.", keywords: ["Money"], choices: [{text:"Financial abuse is a powerful trap.", change:1}, {text:"There are shelters.", change:0}, {text:"You have to leave anyway.", change:-1}] },
                    { text: "But I can't stay blind anymore. I need a <span class='keyword' data-key='Secret'>Secret</span>. A backup plan. Just in case.", keywords: ["Secret"], choices: [{text:"A safety plan is a smart first step.", change:2}, {text:"Secrets are dangerous.", change:-1}, {text:"Just in case of what?", change:0}] }
                ],
                formulation: [
                    { id:1, keys:["Police","Lied"], title:"The Event (Intervention)" },
                    { id:2, keys:["Silent","Perfect Husband"], title:"The Cycle (Manipulation)" },
                    { id:3, keys:["Money","Secret"], title:"The Trap (Financial)" }
                ],
                outro: "Sarah wipes her face. 'I'm not leaving today,' she says firmly. 'But I'm going to open a separate bank account.'<br><br>She checks her phone. 5 missed calls. She puts on her sunglasses and steps back into the danger. She is not free, but she is awake.<br><br><strong>CHAPTER 1 COMPLETE.</strong>"
            },

            // --- SARAH T CHAPTER 2 (20-23) ---
            {
                id: 20, client: "Sarah T.", title: "The Erosion",
                briefing: "<p><strong>Subject:</strong> Sarah T. (34)<br><strong>Timeline:</strong> 2 Weeks Later.<br><strong>Topic:</strong> Coercive Control.<br><strong>Goal:</strong> Identify the non-physical tactics being used to destabilize her.</p>",
                trust: 2,
                script: [
                    { text: "He hasn't hit me since the police came. So I guess I'm making a big deal out of nothing. But I feel like I'm going <span class='keyword' data-key='Crazy'>Crazy</span>.", keywords: ["Crazy"], choices: [{text:"Abuse isn't just physical.", change:1}, {text:"Why do you feel crazy?", change:0}, {text:"If he hasn't hit you, what's the problem?", change:-2}] },
                    { text: "He installed an app on my <span class='keyword' data-key='Phone'>Phone</span>. 'Find My Family'. He says it's for my <span class='keyword' data-key='Safety'>Safety</span>, in case I break down.", keywords: ["Phone", "Safety"], choices: [{text:"That sounds like surveillance, not safety.", change:1}, {text:"It's nice that he worries.", change:-2}, {text:"Do you feel safer?", change:0}] },
                    { text: "If I stop at the grocery store for too long, he texts. 'Everything okay?'. It feels like love, but it feels like a leash.", keywords: [], choices: [{text:"It is a leash.", change:1}, {text:"He is monitoring your movements.", change:1}, {text:"Maybe he's just anxious.", change:-1}] },
                    { text: "And I keep losing things. Keys, receipts. Mark says I'm becoming <span class='keyword' data-key='Forgetful'>Forgetful</span>. He says I'd be lost without him.", keywords: ["Forgetful"], choices: [{text:"Is it possible he is moving them?", change:0}, {text:"He is undermining your confidence.", change:1}, {text:"You do seem stressed.", change:-1}] },
                    { text: "I don't know what's true anymore. Maybe I am ungrateful. The <span class='keyword' data-key='Confusion'>Confusion</span> is worse than the bruises. At least bruises heal.", keywords: ["Confusion"], choices: [{text:"Confusion is the goal of gaslighting.", change:1}, {text:"You need to focus.", change:-1}, {text:"Trust your gut, not his words.", change:1}] },
                    { text: "I need to find the <span class='keyword' data-key='Truth'>Truth</span>. Am I the problem? Or is he erasing me?", keywords: ["Truth"], choices: [{text:"He is eroding your sense of self.", change:2}, {text:"You are the problem.", change:-3}, {text:"Let's look at the facts.", change:0}] }
                ],
                formulation: [
                    { id:1, keys:["Phone","Safety"], title:"Surveillance (Control)" },
                    { id:2, keys:["Crazy","Forgetful"], title:"Gaslighting (Destabilization)" },
                    { id:3, keys:["Confusion","Truth"], title:"Erosion (Reality)" }
                ],
                outro: "Sarah looks at her phone. 'I'm turning the GPS off,' she says. 'Just for an hour. I need to know I still exist.'"
            },
            {
                id: 21, client: "Sarah T.", title: "The Catalyst",
                briefing: "<p><strong>Subject:</strong> Sarah T. (34)<br><strong>Timeline:</strong> 1 Week Later.<br><strong>Incident:</strong> Argument involving the children.<br><strong>Goal:</strong> Recognize that the 'shield' is broken.</p>",
                trust: 3,
                script: [
                    { text: "It happened. The line was crossed. It wasn't me this time. It was <span class='keyword' data-key='Leo'>Leo</span>.", keywords: ["Leo"], choices: [{text:"Is he okay?", change:1}, {text:"Did he hurt him?", change:0}, {text:"I told you this would happen.", change:-2}] },
                    { text: "Mark didn't hit him. But Leo spilled his juice. Mark screamed. He threw his <span class='keyword' data-key='Plate'>Plate</span> against the wall. It shattered right next to Leo's head.", keywords: ["Plate"], choices: [{text:"That is violence, Sarah.", change:1}, {text:"He missed, though.", change:-2}, {text:"That is terrifying for a child.", change:1}] },
                    { text: "Leo didn't cry. He just... <span class='keyword' data-key='Flinched'>Flinched</span>. And then he went silent. He looked exactly like me.", keywords: ["Flinched"], choices: [{text:"He is learning to be invisible.", change:1}, {text:"He's a tough kid.", change:-2}, {text:"He is traumatized.", change:0}] },
                    { text: "I thought I was a <span class='keyword' data-key='Shield'>Shield</span>. I thought if I took the abuse, the kids would be fine. But I was wrong.", keywords: ["Shield"], choices: [{text:"You can't shield them from the environment.", change:1}, {text:"You failed to protect them.", change:-3}, {text:"It's not your fault.", change:0}] },
                    { text: "The shield is <span class='keyword' data-key='Broken'>Broken</span>. Living in that house *is* the abuse. Even if he never touches them.", keywords: ["Broken"], choices: [{text:"Witnessing abuse is abuse.", change:1}, {text:"So what now?", change:0}, {text:"It took you this long to see that?", change:-2}] },
                    { text: "I have to get them out. It's not about me anymore. It's about <span class='keyword' data-key='Reality'>Reality</span>. We are not safe.", keywords: ["Reality"], choices: [{text:"Prioritizing their safety is the bravest thing you can do.", change:2}, {text:"Finally.", change:-1}, {text:"Do you have a plan?", change:0}] }
                ],
                formulation: [
                    { id:1, keys:["Plate","Scream"], title:"Violence (Intimidation)" }, // Note: Scream not in text, implied context or need keyword.
                    // FIX: Let's use "Shouting" from previous or add "Scream" to text.
                    // Text 2 says "Mark screamed". Let's key "Screamed".
                    { id:2, keys:["Leo","Flinched"], title:"Trauma (Impact)" },
                    { id:3, keys:["Shield","Broken"], title:"Reality (Failure of Protection)" }
                ],
                // Manual Fix for keys
                outro: "Sarah's voice is cold and steady. 'I am not a wife anymore,' she says. 'I am a mother. And mothers protect their young.'"
            },
            {
                id: 22, client: "Sarah T.", title: "The Logistics",
                briefing: "<p><strong>Subject:</strong> Sarah T. (34)<br><strong>Timeline:</strong> 2 Days Later.<br><strong>Topic:</strong> The Exit Plan.<br><strong>Goal:</strong> Manage the terror of leaving.</p>",
                trust: 3,
                script: [
                    { text: "I'm doing it. I'm leaving. But I feel sick. If he finds out, I don't know what he'll do.", keywords: [], choices: [{text:"The most dangerous time is when you leave.", change:1}, {text:"You'll be fine.", change:-1}, {text:"Focus on the plan.", change:0}] },
                    { text: "I packed a <span class='keyword' data-key='Bag'>Bag</span>. Essentials only. Documents, cash, Leo's inhaler. It's hidden in the back of the <span class='keyword' data-key='Closet'>Closet</span>.", keywords: ["Bag", "Closet"], choices: [{text:"Good. Physical preparation helps anxiety.", change:1}, {text:"Is that a safe hiding spot?", change:0}, {text:"Make sure you didn't forget anything.", change:0}] },
                    { text: "I have a window. <span class='keyword' data-key='Friday'>Friday</span>. He has a staff <span class='keyword' data-key='Meeting'>Meeting</span> at 2 PM. I have exactly 45 minutes to get the kids and go.", keywords: ["Friday", "Meeting"], choices: [{text:"That is your Opportunity.", change:1}, {text:"That's not enough time.", change:-1}, {text:"Be ready early.", change:0}] },
                    { text: "What if he comes home early? What if the car doesn't start? The fear of <span class='keyword' data-key='Discovery'>Discovery</span> is paralyzing.", keywords: ["Discovery"], choices: [{text:"Focus on what you can control.", change:1}, {text:"Don't think about that.", change:-1}, {text:"Have a backup plan.", change:0}] },
                    { text: "If he catches me... the <span class='keyword' data-key='Consequence'>Consequence</span>... he might kill me. I know that now.", keywords: ["Consequence"], choices: [{text:"Acknowledging the lethality is vital.", change:1}, {text:"He wouldn't go that far.", change:-3}, {text:"Call the police if he appears.", change:0}] },
                    { text: "I have to be invisible until Friday. I have to act normal. It's the performance of my life.", keywords: [], choices: [{text:"You can do this.", change:1}, {text:"Don't overact.", change:0}, {text:"Stay calm.", change:0}] }
                ],
                formulation: [
                    { id:1, keys:["Bag","Closet"], title:"Safety Net (Preparation)" },
                    { id:2, keys:["Friday","Meeting"], title:"Opportunity (The Window)" },
                    { id:3, keys:["Discovery","Consequence"], title:"The Risk (Lethality)" }
                ],
                outro: "Sarah checks her watch. '48 hours,' she whispers. 'I just have to survive 48 hours.'<br><br>The plan is set."
            },
            {
                id: 23, client: "Sarah T.", title: "The Silence",
                briefing: "<p><strong>Subject:</strong> Sarah T. (34)<br><strong>Timeline:</strong> 1 Week Later.<br><strong>Status:</strong> Client is safe in a shelter.<br><strong>Goal:</strong> Maintain the boundary against manipulation.</p>",
                trust: 4,
                script: [
                    { text: "We made it. We're at my sister's. But... my phone hasn't stopped ringing.", keywords: [], choices: [{text:"You are safe now.", change:1}, {text:"Don't answer it.", change:0}, {text:"What does he want?", change:0}] },
                    { text: "He left a <span class='keyword' data-key='Voicemail'>Voicemail</span>. He was <span class='keyword' data-key='Crying'>Crying</span>. He said he can't live without us. He said he's sorry.", keywords: ["Voicemail", "Crying"], choices: [{text:"That is manipulation, not remorse.", change:2}, {text:"Maybe he means it.", change:-2}, {text:"It's hard to hear him in pain.", change:0}] },
                    { text: "He said if I don't come back, it's my <span class='keyword' data-key='Fault'>Fault</span> if he hurts himself. He needs me to <span class='keyword' data-key='Rescue'>Rescue</span> him.", keywords: ["Fault", "Rescue"], choices: [{text:"You are not responsible for his actions.", change:1}, {text:"That is a trap.", change:1}, {text:"You should go check on him.", change:-3}] },
                    { text: "I feel so guilty. I broke my family. But then I look at Leo sleeping peacefully... and I know.", keywords: [], choices: [{text:"You didn't break it, you saved it.", change:1}, {text:"Guilt is normal.", change:0}, {text:"Stay strong.", change:0}] },
                    { text: "I have to <span class='keyword' data-key='Block'>Block</span> his number. I have to choose <span class='keyword' data-key='Silence'>Silence</span>. It's the only way to breathe.", keywords: ["Block", "Silence"], choices: [{text:"Silence is your freedom.", change:2}, {text:"Are you sure?", change:-1}, {text:"Do it.", change:0}] },
                    { text: "I'm going to turn off the phone now. For the first time in ten years... I'm going to be free.", keywords: [], choices: [{text:"Welcome to your new life, Sarah.", change:2}, {text:"Good luck.", change:0}, {text:"It won't be easy.", change:0}] }
                ],
                formulation: [
                    { id:1, keys:["Voicemail","Crying"], title:"Manipulation (Hoovering)" },
                    { id:2, keys:["Fault","Rescue"], title:"The Trap (Guilt)" },
                    { id:3, keys:["Block","Silence"], title:"Freedom (No Contact)" }
                ],
                outro: "Sarah presses the 'Block' button. Her hand shakes, then steadies.<br><br>'It's quiet,' she says, smiling through tears. 'It's finally quiet.'<br><br><strong>CASE CLOSED.</strong>"
            }
        ];

        // MANUAL FIXES FOR KEYWORDS
        SESSIONS[21].script[1].keywords = ["Plate", "Screamed"]; // Add Screamed
        SESSIONS[21].script[1].text = "Mark didn't hit him. But Leo spilled his juice. Mark <span class='keyword' data-key='Screamed'>Screamed</span>. He threw his <span class='keyword' data-key='Plate'>Plate</span> against the wall.";
        SESSIONS[21].formulation[0].keys = ["Plate", "Screamed"];

        let currSessionIdx = 0;
        let session = null;
        let trust = 3;
        let stage = 0;
        let notes = [];
        let selected = [];
        let solved = [];

        function showClientMenu(client) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('menuScreen').classList.add('active');

            const menuTitle = document.getElementById('menuTitle');
            const sessionList = document.getElementById('sessionList');
            sessionList.innerHTML = '';

            // Check Progress (Restored from LocalStorage)
            let progress = JSON.parse(localStorage.getItem('mindMenderProgress')) || { alex: 0, elena: 0, sarah: 0 };

            if (client === 'alex') {
                menuTitle.innerText = "CLIENT 01: ALEX M.";
                renderChapter("Chapter 1: The Workplace", 0, 3, progress.alex);
                renderChapter("Chapter 2: The Origin", 4, 7, progress.alex);
            } else if (client === 'elena') {
                menuTitle.innerText = "CLIENT 02: ELENA R.";
                renderChapter("Chapter 1: The Control", 8, 11, progress.elena);
                renderChapter("Chapter 2: The Recovery", 12, 15, progress.elena);
            } else if (client === 'sarah') {
                menuTitle.innerText = "CLIENT 03: SARAH T.";
                renderChapter("Chapter 1: The Household", 16, 19, progress.sarah);
                renderChapter("Chapter 2: The Exit", 20, 23, progress.sarah);
            }
        }

        function renderChapter(title, start, end, unlockedMax) {
            const list = document.getElementById('sessionList');
            const header = document.createElement('div');
            header.className = 'chapter-label';
            header.innerText = title;
            list.appendChild(header);

            for(let i=start; i<=end; i++) {
                const s = SESSIONS[i];
                let btn = document.createElement('button');

                // Adjusting for client offset
                // Alex: 0-7, Elena: 8-15, Sarah: 16+
                let offset = 0;
                if (start >= 16) offset = 16;
                else if (start >= 8) offset = 8;

                let clientProgress = unlockedMax;
                let relativeIndex = i - offset;

                // Unlock logic (Restored)
                let isUnlocked = relativeIndex <= clientProgress;
                if(relativeIndex === 0) isUnlocked = true;

                if (isUnlocked) {
                    btn.className = 'session-btn';
                    if (relativeIndex < clientProgress) btn.classList.add('completed');
                    btn.onclick = () => initSession(i);
                } else {
                    btn.className = 'session-btn locked';
                    btn.disabled = true;
                }

                // Display number relative to client
                // Alex 0-7 -> 1-8
                // Elena 8-15 -> 1-8
                // Sarah 16-23 -> 1-8
                let sNum = relativeIndex + 1;

                btn.innerHTML = `<span class='s-name'>SESSION ${sNum}: ${s.title.toUpperCase()}</span><span class='s-desc'>${extractGoal(s.briefing)}</span>`;
                list.appendChild(btn);
            }
        }

        function extractGoal(html) {
            let match = html.match(/Goal:<\/strong> (.*?)<\/p>/);
            return match ? match[1] : "Tap to view briefing.";
        }

        function showSelectionScreen() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('selectionScreen').classList.add('active');
        }

        function showMenu() {
             if (currSessionIdx <= 7) showClientMenu('alex');
             else if (currSessionIdx <= 15) showClientMenu('elena');
             else showClientMenu('sarah');
        }

        function returnToMenu() {
             // Save progress logic can remain, but menu is unlocked anyway
             showMenu();
        }

        function initSession(idx) {
            currSessionIdx = idx;
            session = SESSIONS[idx];
            trust = session.trust;
            stage = 0;
            notes = [];
            selected = [];
            solved = [];

            document.getElementById('briefingText').innerHTML = session.briefing;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('briefingScreen').classList.add('active');
        }

        function startGame() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('gameScreen').classList.add('active');

            // Calc Session Display Number
            let offset = 0;
            if(currSessionIdx >= 16) offset = 16;
            else if(currSessionIdx >= 8) offset = 8;
            let sNum = currSessionIdx - offset + 1;

            document.getElementById('sessionTitleDisplay').innerText = `S${sNum}`;
            document.getElementById('avatarDisplay').innerText = session.client.split(' ').map(n=>n[0]).join('');
            document.getElementById('chatLog').innerHTML = "";
            document.getElementById('clueBoard').innerHTML = "";
            document.getElementById('noteCount').innerText = "0";

            const list = document.getElementById('insightList');
            list.innerHTML = "";
            session.formulation.forEach(f => {
                let li = document.createElement('li');
                li.className = "insight-item";
                li.id = `ins-${f.id}`;
                li.innerText = "???";
                list.appendChild(li);
            });

            document.getElementById('btnSolve').style.display = "none";
            document.getElementById('choice-ui-container').innerHTML = "";
            document.getElementById('choicePrompt').innerText = "WAITING FOR CLIENT...";

            updateTrustUI();
            nextBeat();
        }

        function finishSession() {
    // 1) Load sticker book
    let progress = JSON.parse(localStorage.getItem('mindMenderProgress')) || { alex: 0, elena: 0, sarah: 0 };

    // 2) Figure out which client we are playing
    let clientKey = 'alex';
    if (currSessionIdx >= 16) clientKey = 'sarah';
    else if (currSessionIdx >= 8) clientKey = 'elena';

    // 3) Figure out session number inside that client (0,1,2,3...)
    let offset = 0;
    if (clientKey === 'sarah') offset = 16;
    else if (clientKey === 'elena') offset = 8;

    let relativeIndex = currSessionIdx - offset;

    // 4) Unlock NEXT session (so if you finished 0, unlock becomes 1)
    progress[clientKey] = Math.max(progress[clientKey], relativeIndex + 1);

    // 5) Save sticker book
    localStorage.setItem('mindMenderProgress', JSON.stringify(progress));

    // 6) Continue your normal victory screen
    document.getElementById('victoryText').innerHTML = session.outro;
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById('victoryScreen').classList.add('active');
}

        function nextBeat() {
            if (stage >= session.script.length) {
                sysMsg("Session Transcript Complete. Review notes to finish.");
                document.getElementById('choice-ui-container').innerHTML = "";
                document.getElementById('choicePrompt').innerText = "REVIEW PHASE";
                revealRetroactive();
                return;
            }

            const beat = session.script[stage];
            addMsg('client', beat.text, stage);

            const cDiv = document.getElementById('choice-ui-container');
            if (cDiv) {
                cDiv.innerHTML = "";
                document.getElementById('choicePrompt').innerText = "CHOOSE RESPONSE";

                beat.choices.forEach(c => {
                    let btn = document.createElement('div');
                    btn.className = 'choice-btn';
                    btn.innerText = c.text;
                    btn.onclick = () => makeChoice(c, stage);
                    cDiv.appendChild(btn);
                });
            }
        }

        function makeChoice(choice, beatIdx) {
            trust += choice.change;
            if (trust > 5) trust = 5;
            if (trust < 1) trust = 1;
            updateTrustUI();

            addMsg('therapist', choice.text);

            revealRetroactive();
            const beat = session.script[beatIdx];

            if (beat.keywords.length > 0) {
                if (trust >= 3) {
                    let newClue = beat.keywords.some(k => !notes.includes(k));
                    if(newClue) setTimeout(()=>showToast("Keywords Revealed"), 300);
                } else {
                    showToast("Rapport Low - Clues Hidden");
                }
            }

            stage++;
            setTimeout(nextBeat, 600);
        }

        function revealRetroactive() {
            if (trust < 3) return;
            document.querySelectorAll('.keyword.hidden').forEach(k => {
                k.classList.remove('hidden');
                k.classList.add('revealed');
                k.onclick = () => collect(k.dataset.key, k);
            });
        }

        function collect(key, el) {
            if (notes.includes(key)) return;
            notes.push(key);
            el.classList.remove('revealed');
            el.classList.add('collected');
            el.onclick = null;

            let card = document.createElement('div');
            card.className = 'clue-card';
            card.innerText = key;
            card.onclick = () => toggleSelect(card, key);
            document.getElementById('clueBoard').appendChild(card);
            document.getElementById('noteCount').innerText = notes.length;
        }

        function toggleSelect(el, key) {
            if (selected.includes(key)) {
                selected = selected.filter(k => k !== key);
                el.classList.remove('selected');
            } else {
                if (selected.length < 2) {
                    selected.push(key);
                    el.classList.add('selected');
                }
            }
            document.getElementById('btnLink').innerText = `LINK (${selected.length}/2)`;
        }

        function linkNotes() {
            if (selected.length !== 2) {
                showToast("Select 2 notes");
                return;
            }

            let match = session.formulation.find(f => f.keys.every(k => selected.includes(k)));

            if (match) {
                if (solved.includes(match.id)) {
                    showToast("Already Solved");
                } else {
                    solved.push(match.id);
                    let li = document.getElementById(`ins-${match.id}`);
                    li.innerText = match.title;
                    li.classList.add('done');
                    showToast("Insight Formed!");

                    document.querySelectorAll('.clue-card.selected').forEach(e => e.classList.remove('selected'));
                    selected = [];

                    if (solved.length === 3) {
                        sysMsg("FORMULATION COMPLETE.");
                        document.getElementById('btnSolve').style.display = 'block';
                    }
                }
            } else {
                showToast("No Connection");
                document.querySelectorAll('.clue-card.selected').forEach(e => e.classList.remove('selected'));
                selected = [];
            }
            document.getElementById('btnLink').innerText = `LINK (0/2)`;
        }

        /* --- UI HELPERS --- */
        function addMsg(role, html, id=null) {
            let div = document.createElement('div');
            div.className = `msg ${role}`;
            if (id !== null) div.id = `msg-${id}`;

            if (role === 'client') {
                html = html.replace(/class='keyword'/g, "class='keyword hidden'");
            }
            div.innerHTML = html;
            const log = document.getElementById('chatLog');
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }

        function sysMsg(txt) {
            let div = document.createElement('div');
            div.className = "msg system";
            div.innerText = txt;
            const log = document.getElementById('chatLog');
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }

        function updateTrustUI() {
            const colors = [
                "var(--trust-low)", "var(--trust-low)",
                "var(--trust-mid)",
                "var(--trust-high)", "var(--trust-high)"
            ];
            const labels = ["HOSTILE", "GUARDED", "NEUTRAL", "OPEN", "TRUSTING"];

            let pips = document.querySelectorAll('.pip');
            pips.forEach((p, i) => {
                if (i < trust) {
                    p.style.backgroundColor = colors[trust-1] || colors[2];
                    p.classList.add('filled');
                } else {
                    p.style.backgroundColor = "#cfd8dc";
                    p.classList.remove('filled');
                }
            });
            let label = document.getElementById('trustLabel');
            label.innerText = `RAPPORT: ${labels[trust-1] || 'NEUTRAL'}`;
            label.style.color = colors[trust-1] || colors[2];
        }

        function showToast(txt) {
            let t = document.getElementById('toast');
            t.innerText = txt;
            t.style.opacity = 1;
            setTimeout(() => t.style.opacity = 0, 2000);
        }

    </script>
</body>
</html>